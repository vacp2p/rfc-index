<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>17/RLN Relay - Vac RFC</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../../favicon.svg">
        <link rel="shortcut icon" href="../../../../favicon.png">
        <link rel="stylesheet" href="../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../css/general.css">
        <link rel="stylesheet" href="../../../../css/chrome.css">
        <link rel="stylesheet" href="../../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../../highlight.css">
        <link rel="stylesheet" href="../../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../../custom.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../../../index.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Vac</li><li class="chapter-item expanded "><a href="../../../../vac/1/coss.html"><strong aria-hidden="true">1.</strong> 1/COSS</a></li><li class="chapter-item expanded "><a href="../../../../vac/2/mvds.html"><strong aria-hidden="true">2.</strong> 2/MVDS</a></li><li class="chapter-item expanded "><a href="../../../../vac/3/remote-log.html"><strong aria-hidden="true">3.</strong> 3/Remote Log</a></li><li class="chapter-item expanded "><a href="../../../../vac/4/mvds-meta.html"><strong aria-hidden="true">4.</strong> 4/MVDS Meta</a></li><li class="chapter-item expanded "><a href="../../../../vac/25/libp2p-dns-discovery.html"><strong aria-hidden="true">5.</strong> 25/Libp2p DNS Discovery</a></li><li class="chapter-item expanded "><a href="../../../../vac/32/rln-v1.html"><strong aria-hidden="true">6.</strong> 32/RLN-V1</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/index.html"><strong aria-hidden="true">7.</strong> Raw</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../vac/raw/consensus-hashgraphlike.html"><strong aria-hidden="true">7.1.</strong> Consensus Hashgraphlike</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/decentralized-messaging-ethereum.html"><strong aria-hidden="true">7.2.</strong> Decentralized Messaging Ethereum</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/eth-mls-offchain.html"><strong aria-hidden="true">7.3.</strong> ETH MLS Offchain</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/eth-mls-onchain.html"><strong aria-hidden="true">7.4.</strong> ETH MLS Onchain</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/deleted/eth-secpm.html"><strong aria-hidden="true">7.5.</strong> ETH SecPM</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/gossipsub-tor-push.html"><strong aria-hidden="true">7.6.</strong> Gossipsub Tor Push</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/logos-capability-discovery.html"><strong aria-hidden="true">7.7.</strong> Logos Capability Discovery</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/mix.html"><strong aria-hidden="true">7.8.</strong> Mix</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/noise-x3dh-double-ratchet.html"><strong aria-hidden="true">7.9.</strong> Noise X3DH Double Ratchet</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/rln-interep-spec.html"><strong aria-hidden="true">7.10.</strong> RLN Interep Spec</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/rln-stealth-commitments.html"><strong aria-hidden="true">7.11.</strong> RLN Stealth Commitments</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/rln-v2.html"><strong aria-hidden="true">7.12.</strong> RLN-V2</a></li><li class="chapter-item expanded "><a href="../../../../vac/raw/sds.html"><strong aria-hidden="true">7.13.</strong> SDS</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../vac/template.html"><strong aria-hidden="true">8.</strong> Template</a></li><li class="chapter-item expanded affix "><li class="part-title">Waku</li><li class="chapter-item expanded "><a href="../../../../waku/index.html"><strong aria-hidden="true">9.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/10/waku2.html"><strong aria-hidden="true">10.</strong> Standards - Core</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../waku/standards/core/10/waku2.html"><strong aria-hidden="true">10.1.</strong> 10/Waku2</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/11/relay.html"><strong aria-hidden="true">10.2.</strong> 11/Relay</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/12/filter.html"><strong aria-hidden="true">10.3.</strong> 12/Filter</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/13/store.html"><strong aria-hidden="true">10.4.</strong> 13/Store</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/14/message.html"><strong aria-hidden="true">10.5.</strong> 14/Message</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/15/bridge.html"><strong aria-hidden="true">10.6.</strong> 15/Bridge</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/17/rln-relay.html" class="active"><strong aria-hidden="true">10.7.</strong> 17/RLN Relay</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/19/lightpush.html"><strong aria-hidden="true">10.8.</strong> 19/Lightpush</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/31/enr.html"><strong aria-hidden="true">10.9.</strong> 31/ENR</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/33/discv5.html"><strong aria-hidden="true">10.10.</strong> 33/Discv5</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/34/peer-exchange.html"><strong aria-hidden="true">10.11.</strong> 34/Peer Exchange</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/36/bindings-api.html"><strong aria-hidden="true">10.12.</strong> 36/Bindings API</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/64/network.html"><strong aria-hidden="true">10.13.</strong> 64/Network</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/core/66/metadata.html"><strong aria-hidden="true">10.14.</strong> 66/Metadata</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../waku/standards/application/20/toy-eth-pm.html"><strong aria-hidden="true">11.</strong> Standards - Application</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../waku/standards/application/20/toy-eth-pm.html"><strong aria-hidden="true">11.1.</strong> 20/Toy ETH PM</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/application/26/payload.html"><strong aria-hidden="true">11.2.</strong> 26/Payload</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/application/53/x3dh.html"><strong aria-hidden="true">11.3.</strong> 53/X3DH</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/application/54/x3dh-sessions.html"><strong aria-hidden="true">11.4.</strong> 54/X3DH Sessions</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../waku/standards/legacy/6/waku1.html"><strong aria-hidden="true">12.</strong> Standards - Legacy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../waku/standards/legacy/6/waku1.html"><strong aria-hidden="true">12.1.</strong> 6/Waku1</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/legacy/7/data.html"><strong aria-hidden="true">12.2.</strong> 7/Data</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/legacy/8/mail.html"><strong aria-hidden="true">12.3.</strong> 8/Mail</a></li><li class="chapter-item expanded "><a href="../../../../waku/standards/legacy/9/rpc.html"><strong aria-hidden="true">12.4.</strong> 9/RPC</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../waku/informational/22/toy-chat.html"><strong aria-hidden="true">13.</strong> Informational</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../waku/informational/22/toy-chat.html"><strong aria-hidden="true">13.1.</strong> 22/Toy Chat</a></li><li class="chapter-item expanded "><a href="../../../../waku/informational/23/topics.html"><strong aria-hidden="true">13.2.</strong> 23/Topics</a></li><li class="chapter-item expanded "><a href="../../../../waku/informational/27/peers.html"><strong aria-hidden="true">13.3.</strong> 27/Peers</a></li><li class="chapter-item expanded "><a href="../../../../waku/informational/29/config.html"><strong aria-hidden="true">13.4.</strong> 29/Config</a></li><li class="chapter-item expanded "><a href="../../../../waku/informational/30/adaptive-nodes.html"><strong aria-hidden="true">13.5.</strong> 30/Adaptive Nodes</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../waku/deprecated/index.html"><strong aria-hidden="true">14.</strong> Deprecated</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../waku/deprecated/5/waku0.html"><strong aria-hidden="true">14.1.</strong> 5/Waku0</a></li><li class="chapter-item expanded "><a href="../../../../waku/deprecated/16/rpc.html"><strong aria-hidden="true">14.2.</strong> 16/RPC</a></li><li class="chapter-item expanded "><a href="../../../../waku/deprecated/18/swap.html"><strong aria-hidden="true">14.3.</strong> 18/Swap</a></li><li class="chapter-item expanded "><a href="../../../../waku/deprecated/fault-tolerant-store.html"><strong aria-hidden="true">14.4.</strong> Fault Tolerant Store</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Nomos</li><li class="chapter-item expanded "><a href="../../../../nomos/index.html"><strong aria-hidden="true">15.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../../../../nomos/raw/nomosda-encoding.html"><strong aria-hidden="true">16.</strong> Raw</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../nomos/raw/nomosda-encoding.html"><strong aria-hidden="true">16.1.</strong> NomosDA Encoding</a></li><li class="chapter-item expanded "><a href="../../../../nomos/raw/nomosda-network.html"><strong aria-hidden="true">16.2.</strong> NomosDA Network</a></li><li class="chapter-item expanded "><a href="../../../../nomos/raw/p2p-hardware-requirements.html"><strong aria-hidden="true">16.3.</strong> P2P Hardware Requirements</a></li><li class="chapter-item expanded "><a href="../../../../nomos/raw/p2p-nat-solution.html"><strong aria-hidden="true">16.4.</strong> P2P NAT Solution</a></li><li class="chapter-item expanded "><a href="../../../../nomos/raw/p2p-network-bootstrapping.html"><strong aria-hidden="true">16.5.</strong> P2P Network Bootstrapping</a></li><li class="chapter-item expanded "><a href="../../../../nomos/raw/p2p-network.html"><strong aria-hidden="true">16.6.</strong> P2P Network</a></li><li class="chapter-item expanded "><a href="../../../../nomos/raw/sdp.html"><strong aria-hidden="true">16.7.</strong> SDP</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../nomos/deprecated/claro.html"><strong aria-hidden="true">17.</strong> Deprecated</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../nomos/deprecated/claro.html"><strong aria-hidden="true">17.1.</strong> Claro</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Codex</li><li class="chapter-item expanded "><a href="../../../../codex/index.html"><strong aria-hidden="true">18.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../../../../codex/raw/codex-block-exchange.html"><strong aria-hidden="true">19.</strong> Raw</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../codex/raw/codex-block-exchange.html"><strong aria-hidden="true">19.1.</strong> Block Exchange</a></li><li class="chapter-item expanded "><a href="../../../../codex/raw/codex-marketplace.html"><strong aria-hidden="true">19.2.</strong> Marketplace</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Status</li><li class="chapter-item expanded "><a href="../../../../status/index.html"><strong aria-hidden="true">20.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../../../../status/24/curation.html"><strong aria-hidden="true">21.</strong> 24/Curation</a></li><li class="chapter-item expanded "><a href="../../../../status/28/featuring.html"><strong aria-hidden="true">22.</strong> 28/Featuring</a></li><li class="chapter-item expanded "><a href="../../../../status/55/1to1-chat.html"><strong aria-hidden="true">23.</strong> 55/1-to-1 Chat</a></li><li class="chapter-item expanded "><a href="../../../../status/56/communities.html"><strong aria-hidden="true">24.</strong> 56/Communities</a></li><li class="chapter-item expanded "><a href="../../../../status/61/community-history-service.html"><strong aria-hidden="true">25.</strong> 61/Community History Service</a></li><li class="chapter-item expanded "><a href="../../../../status/62/payloads.html"><strong aria-hidden="true">26.</strong> 62/Payloads</a></li><li class="chapter-item expanded "><a href="../../../../status/63/keycard-usage.html"><strong aria-hidden="true">27.</strong> 63/Keycard Usage</a></li><li class="chapter-item expanded "><a href="../../../../status/65/account-address.html"><strong aria-hidden="true">28.</strong> 65/Account Address</a></li><li class="chapter-item expanded "><a href="../../../../status/71/push-notification-server.html"><strong aria-hidden="true">29.</strong> 71/Push Notification Server</a></li><li class="chapter-item expanded "><a href="../../../../status/raw/simple-scaling.html"><strong aria-hidden="true">30.</strong> Raw</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../status/raw/simple-scaling.html"><strong aria-hidden="true">30.1.</strong> Simple Scaling</a></li><li class="chapter-item expanded "><a href="../../../../status/raw/status-app-protocols.html"><strong aria-hidden="true">30.2.</strong> Status App Protocols</a></li><li class="chapter-item expanded "><a href="../../../../status/raw/status-mvds.html"><strong aria-hidden="true">30.3.</strong> Status MVDS</a></li><li class="chapter-item expanded "><a href="../../../../status/raw/url-data.html"><strong aria-hidden="true">30.4.</strong> URL Data</a></li><li class="chapter-item expanded "><a href="../../../../status/raw/url-scheme.html"><strong aria-hidden="true">30.5.</strong> URL Scheme</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/3rd-party.html"><strong aria-hidden="true">31.</strong> Deprecated</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../status/deprecated/3rd-party.html"><strong aria-hidden="true">31.1.</strong> 3rd Party</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/account.html"><strong aria-hidden="true">31.2.</strong> Account</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/client.html"><strong aria-hidden="true">31.3.</strong> Client</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/dapp-browser-API-usage.html"><strong aria-hidden="true">31.4.</strong> Dapp Browser API Usage</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/eips.html"><strong aria-hidden="true">31.5.</strong> EIPs</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/ethereum-usage.html"><strong aria-hidden="true">31.6.</strong> Ethereum Usage</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/group-chat.html"><strong aria-hidden="true">31.7.</strong> Group Chat</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/IPFS-gateway-for-sticker-Pack.html"><strong aria-hidden="true">31.8.</strong> IPFS Gateway for Sticker Pack</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/keycard-usage-for-wallet-and-chat-keys.html"><strong aria-hidden="true">31.9.</strong> Keycard Usage for Wallet and Chat Keys</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/notifications.html"><strong aria-hidden="true">31.10.</strong> Notifications</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/payloads.html"><strong aria-hidden="true">31.11.</strong> Payloads</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/push-notification-server.html"><strong aria-hidden="true">31.12.</strong> Push Notification Server</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/secure-transport.html"><strong aria-hidden="true">31.13.</strong> Secure Transport</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/waku-mailserver.html"><strong aria-hidden="true">31.14.</strong> Waku Mailserver</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/waku-usage.html"><strong aria-hidden="true">31.15.</strong> Waku Usage</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/whisper-mailserver.html"><strong aria-hidden="true">31.16.</strong> Whisper Mailserver</a></li><li class="chapter-item expanded "><a href="../../../../status/deprecated/whisper-usage.html"><strong aria-hidden="true">31.17.</strong> Whisper Usage</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Vac RFC</h1>

                    <div class="right-buttons">
                        <a href="../../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/vacp2p/rfc-index" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<p>slug: 17
title: 17/WAKU2-RLN-RELAY
name: Waku v2 RLN Relay
status: draft
tags: waku-core
editor: Alvaro Revuelta <a href="mailto:alvaro@status.im">alvaro@status.im</a>
contributors:</p>
<ul>
<li>Oskar Thorén <a href="mailto:oskarth@titanproxy.com">oskarth@titanproxy.com</a></li>
<li>Aaryamann Challani <a href="mailto:p1ge0nh8er@proton.me">p1ge0nh8er@proton.me</a></li>
<li>Sanaz Taheri <a href="mailto:sanaz@status.im">sanaz@status.im</a></li>
<li>Hanno Cornelius <a href="mailto:hanno@status.im">hanno@status.im</a></li>
</ul>
<hr />
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>This specification describes the <code>17/WAKU2-RLN-RELAY</code> protocol,
which is an extension of <a href="../11/relay.html"><code>11/WAKU2-RELAY</code></a>
to provide spam protection using <a href="../../../../vac/32/rln-v1.html">Rate Limiting Nullifiers (RLN)</a>.</p>
<p>The security objective is to contain spam activity in the <a href="../64/network.html">64/WAKU-NETWORK</a>
by enforcing a global messaging rate to all the peers.
Peers that violate the messaging rate are considered spammers and
their message is considered spam.
Spammers are also financially punished and removed from the system.</p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>In open and anonymous p2p messaging networks,
one big problem is spam resistance.
Existing solutions, such as Whisper’s proof of work,
are computationally expensive hence not suitable for resource-limited nodes.
Other reputation-based approaches might not be desirable,
due to issues around arbitrary exclusion and privacy.</p>
<p>We augment the <a href="../11/relay.html"><code>11/WAKU2-RELAY</code></a> protocol
with a novel construct of <a href="../../../../vac/32/rln-v1.html">RLN</a>
to enable an efficient economic spam prevention mechanism
that can be run in resource-constrained environments.</p>
<h2 id="specification"><a class="header" href="#specification">Specification</a></h2>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”,
“SHOULD NOT”, “RECOMMENDED”, “MAY”, and
“OPTIONAL” in this document are to be interpreted as described in <a href="https://www.ietf.org/rfc/rfc2119.txt">2119</a>.</p>
<h3 id="flow"><a class="header" href="#flow">Flow</a></h3>
<p>The messaging rate is defined by the <code>period</code>
which indicates how many messages can be sent in a given period.
We define an <code>epoch</code> as $\lceil$ <code>unix_time</code> / <code>period</code> $\rceil$.
For example, if <code>unix_time</code> is <code>1644810116</code> and we set <code>period</code> to <code>30</code>,
then <code>epoch</code> is  $\lceil$ <code>(unix_time/period)</code> $\rceil$ <code>= 54827003</code>.</p>
<blockquote>
<p><strong>NOTE:</strong> The <code>epoch</code> refers to the epoch in RLN and not Unix epoch.
This means a message can only be sent every period,
where the <code>period</code> is up to the application.</p>
</blockquote>
<p>See section <a href="#recommended-system-parameters">Recommended System Parameters</a>
for the RECOMMENDED method to set a sensible <code>period</code> value depending on the application.
Peers subscribed to a spam-protected <code>pubsubTopic</code>
are only allowed to send one message per <code>epoch</code>.
The higher-level layers adopting <code>17/WAKU2-RLN-RELAY</code>
MAY choose to enforce the messaging rate for <code>WakuMessages</code>
with a specific <code>contentTopic</code> published on a <code>pubsubTopic</code>.</p>
<h4 id="setup-and-registration"><a class="header" href="#setup-and-registration">Setup and Registration</a></h4>
<p>A <code>pubsubTopic</code> that is spam-protected requires subscribed peers to form a <a href="../../../../vac/32/rln-v1.html">RLN group</a>.</p>
<ul>
<li>Peers MUST be registered to the RLN group to be able to publish messages.</li>
<li>Registration MAY be moderated through a smart contract
deployed on the Ethereum blockchain.</li>
</ul>
<p>Each peer has an <a href="../../../../vac/32/rln-v1.html">RLN key pair</a> denoted by <code>sk</code>
and <code>pk</code>.</p>
<ul>
<li>The secret key <code>sk</code> is secret data and MUST be persisted securely by the peer.</li>
<li>The state of the membership contract
SHOULD contain a list of all registered members' public identity keys i.e., <code>pk</code>s.</li>
</ul>
<p>For registration,
a peer MUST create a transaction to invoke the registration function on the contract,
which registers its <code>pk</code> in the RLN group.</p>
<ul>
<li>The transaction MUST transfer additional tokens to the contract to be staked.
This amount is denoted by <code>staked_fund</code> and is a system parameter.
The peer who has the secret key <code>sk</code> associated with a registered <code>pk</code>
would be able to withdraw a portion <code>reward_portion</code>
of the staked fund by providing valid proof.</li>
</ul>
<p><code>reward_portion</code> is also a system parameter.</p>
<blockquote>
<p><strong>NOTE:</strong> Initially <code>sk</code> is only known to its owning peer however,
it may get exposed to other peers in case the owner attempts spamming the system
i.e., sending more than one message per <code>epoch</code>.</p>
</blockquote>
<p>An overview of registration is illustrated in Figure 1.</p>
<p><img src="./images/rln-relay.png" alt="Figure 1: Registration." /></p>
<h4 id="publishing"><a class="header" href="#publishing">Publishing</a></h4>
<p>To publish at a given <code>epoch</code>, the publishing peer proceeds
based on the regular <a href="../11/relay.html"><code>11/WAKU2-RELAY</code></a> protocol.
However, to protect against spamming, each <code>WakuMessage</code>
(which is wrapped inside the <code>data</code> field of a PubSub message)
MUST carry a <a href="#ratelimitproof"><code>RateLimitProof</code></a> with the following fields.
Section <a href="#payloads">Payload</a> covers the details about the type and
encoding of these fields.</p>
<ul>
<li>The <code>merkle_root</code> contains the root of the Merkle tree.</li>
<li>The <code>epoch</code> represents the current epoch.</li>
<li>The <code>nullifier</code> is an internal nullifier acting as a fingerprint
that allows specifying whether two messages are published by the same peer
during the same <code>epoch</code>.</li>
<li>The <code>nullifier</code> is a deterministic value derived from <code>sk</code> and
<code>epoch</code> therefore any two messages issued by the same peer
(i.e., using the same <code>sk</code>)
for the same <code>epoch</code> are guaranteed to have identical <code>nullifier</code>s.</li>
<li>The <code>share_x</code> and
<code>share_y</code> can be seen as partial disclosure of peer's <code>sk</code> for the intended <code>epoch</code>.
They are derived deterministically from peer's <code>sk</code> and
current <code>epoch</code> using <a href="../../../../vac/32/rln-v1.html">Shamir secret sharing scheme</a>.</li>
</ul>
<p>If a peer discloses more than one such pair (<code>share_x</code>, <code>share_y</code>) for the same <code>epoch</code>,
it would allow full disclosure of its  <code>sk</code> and
hence get access to its staked fund in the membership contract.</p>
<ul>
<li>The <code>proof</code> field is a zero-knowledge proof signifying that:</li>
</ul>
<ol>
<li>The message owner is the current member of the group i.e.,
the peer's identity commitment key, <code>pk</code>,
is part of the membership group Merkle tree with the root <code>merkle_root</code>.</li>
<li><code>share_x</code> and <code>share_y</code> are correctly computed.</li>
<li>The <code>nullifier</code> is constructed correctly.
For more details about the proof generation check <a href="../../../../vac/32/rln-v1.html">RLN</a>
The proof generation relies on the knowledge of two pieces of private information
i.e., <code>sk</code> and <code>authPath</code>.
The <code>authPath</code> is a subset of Merkle tree nodes
by which a peer can prove the inclusion of its <code>pk</code> in the group.</li>
</ol>
<!-- TODO refer to RLN RFC for authPath def -->
<p>The proof generation also requires a set of public inputs which are:
the Merkle tree root <code>merkle_root</code>, the current <code>epoch</code>, and
the message for which the proof is going to be generated.
In <code>17/WAKU2-RLN-RELAY</code>,
the message is the concatenation of <code>WakuMessage</code>'s  <code>payload</code> filed and
its <code>contentTopic</code> i.e., <code>payload||contentTopic</code>.</p>
<h4 id="group-synchronization"><a class="header" href="#group-synchronization">Group Synchronization</a></h4>
<p>Proof generation relies on the knowledge of Merkle tree root <code>merkle_root</code> and
<code>authPath</code> which both require access to the membership Merkle tree.
Getting access to the Merkle tree can be done in various ways:</p>
<ol>
<li>
<p>Peers construct the tree locally.
This can be done by listening to the registration and
deletion events emitted by the membership contract.
Peers MUST update the local Merkle tree on a per-block basis.
This is discussed further
in the <a href="#merkle-root-validation">Merkle Root Validation</a> section.</p>
</li>
<li>
<p>For synchronizing the state of slashed <code>pk</code>s,
disseminate such information through a <code>pubsubTopic</code> to which all peers are subscribed.
A deletion transaction SHOULD occur on the membership contract.
The benefit of an off-chain slashing
is that it allows real-time removal of spammers as opposed to on-chain slashing
in which peers get informed with a delay,
where the delay is due to mining the slashing transaction.</p>
</li>
</ol>
<p>For the group synchronization,
one important security consideration is that peers MUST make sure they always use
the most recent Merkle tree root in their proof generation.
The reason is that using an old root can allow inference
about the index of the user's <code>pk</code> in the membership tree
hence compromising user privacy and breaking message unlinkability.</p>
<h4 id="routing"><a class="header" href="#routing">Routing</a></h4>
<p>Upon the receipt of a PubSub message via <a href="../11/relay.html"><code>11/WAKU2-RELAY</code></a> protocol,
the routing peer parses the <code>data</code> field as a <code>WakuMessage</code> and
gets access to the <code>RateLimitProof</code> field.<br />
The peer then validates the <code>RateLimitProof</code>  as explained next.</p>
<h5 id="epoch-validation"><a class="header" href="#epoch-validation">Epoch Validation</a></h5>
<p>If the <code>epoch</code> attached to the <code>WakuMessage</code> is more than <code>max_epoch_gap</code>,
apart from the routing peer's current <code>epoch</code>,
then the <code>WakuMessage</code> MUST be discarded and considered invalid.
This is to prevent a newly registered peer from spamming the system
by messaging for all the past epochs.
<code>max_epoch_gap</code> is a system parameter
for which we provide some recommendations in section <a href="#recommended-system-parameters">Recommended System Parameters</a>.</p>
<h5 id="merkle-root-validation"><a class="header" href="#merkle-root-validation">Merkle Root Validation</a></h5>
<p>The routing peers MUST check whether the provided Merkle root
in the <code>RateLimitProof</code> is valid.
It can do so by maintaining a local set of valid Merkle roots,
which consist of <code>acceptable_root_window_size</code> past roots.
These roots refer to the final state of the Merkle tree
after a whole block consisting of group changes is processed.
The Merkle roots are updated on a per-block basis instead of a per-event basis.
This is done because if Merkle roots are updated on a per-event basis,
some peers could send messages with a root that refers to a Merkle tree state
that might get invalidated while the message is still propagating in the network,
due to many registrations happening during this time frame.
By updating roots on a per-block basis instead,
we will have only one root update per-block processed,
regardless on how many registrations happened in a block, and
peers will be able to successfully propagate messages in a time frame
corresponding to roughly the size of the roots window times the block mining time.</p>
<p>Atomic processing of the blocks are necessary
so that even if the peer is unable to process one event,
the previous roots remain valid, and can be used to generate valid RateLimitProof's.</p>
<p>This also allows peers which are not well connected to the network
to be able to send messages, accounting for network delay.
This network delay is related to the nature of asynchronous network conditions,
which means that peers see membership changes asynchronously, and
therefore may have differing local Merkle trees.
See <a href="#recommended-system-parameters">Recommended System Parameters</a>
on choosing an appropriate <code>acceptable_root_window_size</code>.</p>
<h5 id="proof-verification"><a class="header" href="#proof-verification">Proof Verification</a></h5>
<p>The routing peers MUST check whether the zero-knowledge proof <code>proof</code> is valid.
It does so by running the zk verification algorithm as explained in <a href="../../../../vac/32/rln-v1.html">RLN</a>.
If <code>proof</code> is invalid then the message MUST be discarded.</p>
<h5 id="spam-detection"><a class="header" href="#spam-detection">Spam detection</a></h5>
<p>To enable local spam detection and slashing,
routing peers MUST record the <code>nullifier</code>, <code>share_x</code>, and <code>share_y</code>
of incoming messages which are not discarded i.e.,
not found spam or with invalid proof or epoch.
To spot spam messages, the peer checks whether a message
with an identical <code>nullifier</code> has already been relayed.</p>
<ol>
<li>If such a message exists and its <code>share_x</code> and <code>share_y</code>
components are different from the incoming message, then slashing takes place.
That is, the peer uses the  <code>share_x</code> and <code>share_y</code>
of the new message and the <code>share'_x</code> and <code>share'_y</code>
of the old record to reconstruct the <code>sk</code> of the message owner.
The <code>sk</code> then MAY be used to delete the spammer from the group and
withdraw a portion <code>reward_portion</code> of its staked funds.</li>
<li>If the <code>share_x</code> and
<code>share_y</code> fields of the previously relayed message are identical
to the incoming message,
then the message is a duplicate and MUST be discarded.</li>
<li>If none is found, then the message gets relayed.</li>
</ol>
<p>An overview of the routing procedure and slashing is provided in Figure 2.</p>
<p><img src="./images/rln-message-verification.png" alt="Figure 2: Publishing, Routing and Slashing workflow." /></p>
<hr />
<h3 id="payloads"><a class="header" href="#payloads">Payloads</a></h3>
<p>Payloads are protobuf messages implemented using <a href="https://developers.google.com/protocol-buffers/">protocol buffers v3</a>.
Nodes MAY extend the <a href="../14/message.html">14/WAKU2-MESSAGE</a>
with a <code>rate_limit_proof</code> field to indicate that their message is not spam.</p>
<pre><code class="language-diff">
syntax = "proto3";

message RateLimitProof {
  bytes proof = 1;
  bytes merkle_root = 2;
  bytes epoch = 3;
  bytes share_x = 4;
  bytes share_y = 5;
  bytes nullifier = 6;
}

message WakuMessage {
  bytes payload = 1;
  string content_topic = 2;
  optional uint32 version = 3;
  optional sint64 timestamp = 10;
  optional bool ephemeral = 31;
  RateLimitProof rate_limit_proof = 21;
}

</code></pre>
<h4 id="wakumessage"><a class="header" href="#wakumessage">WakuMessage</a></h4>
<p><code>rate_limit_proof</code> holds the information required to prove that the message owner
has not exceeded the message rate limit.</p>
<h4 id="ratelimitproof"><a class="header" href="#ratelimitproof">RateLimitProof</a></h4>
<p>Below is the description of the fields of <code>RateLimitProof</code> and their types.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: right">Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td style="text-align: right"><code>proof</code></td><td>array of 256 bytes uncompressed or 128 bytes compressed</td><td>the zkSNARK proof as explained in the <a href="#publishing">Publishing process</a></td></tr>
<tr><td style="text-align: right"><code>merkle_root</code></td><td>array of 32 bytes in little-endian order</td><td>the root of membership group Merkle tree at the time of publishing the message</td></tr>
<tr><td style="text-align: right"><code>share_x</code> and <code>share_y</code></td><td>array of 32 bytes each</td><td>Shamir secret shares of the user's secret identity key <code>sk</code> . <code>share_x</code> is the Poseidon hash of the <code>WakuMessage</code>'s <code>payload</code> concatenated with its <code>contentTopic</code> . <code>share_y</code> is calculated using <a href="../../../../vac/32/rln-v1.html">Shamir secret sharing scheme</a></td></tr>
<tr><td style="text-align: right"><code>nullifier</code></td><td>array of 32 bytes</td><td>internal nullifier derived from <code>epoch</code> and peer's <code>sk</code> as explained in <a href="../../../../vac/32/rln-v1.html">RLN construct</a></td></tr>
</tbody></table>
</div>
<h3 id="recommended-system-parameters"><a class="header" href="#recommended-system-parameters">Recommended System Parameters</a></h3>
<p>The system parameters are summarized in the following table,
and the RECOMMENDED values for a subset of them are presented next.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: right">Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td style="text-align: right"><code>period</code></td><td>the length of <code>epoch</code> in seconds</td></tr>
<tr><td style="text-align: right"><code>staked_fund</code></td><td>the amount of funds to be staked by peers at the registration</td></tr>
<tr><td style="text-align: right"><code>reward_portion</code></td><td>the percentage of <code>staked_fund</code> to be rewarded to the slashers</td></tr>
<tr><td style="text-align: right"><code>max_epoch_gap</code></td><td>the maximum allowed gap between the <code>epoch</code> of a routing peer and the incoming message</td></tr>
<tr><td style="text-align: right"><code>acceptable_root_window_size</code></td><td>The maximum number of past Merkle roots to store</td></tr>
</tbody></table>
</div>
<h4 id="epoch-length"><a class="header" href="#epoch-length">Epoch Length</a></h4>
<p>A sensible value for the <code>period</code> depends on the application
for which the spam protection is going to be used.
For example, while the <code>period</code> of <code>1</code> second i.e.,
messaging rate of <code>1</code> per second, might be acceptable for a chat application,
might be too low for communication among Ethereum network validators.
One should look at the desired throughput of the application
to decide on a proper <code>period</code> value.</p>
<h4 id="maximum-epoch-gap"><a class="header" href="#maximum-epoch-gap">Maximum Epoch Gap</a></h4>
<p>We discussed in the <a href="#routing">Routing</a> section that the gap between the epoch
observed by the routing peer and
the one attached to the incoming message
should not exceed a threshold denoted by <code>max_epoch_gap</code>.
The value of <code>max_epoch_gap</code> can be measured based on the following factors.</p>
<ul>
<li>Network transmission delay <code>Network_Delay</code>:
the maximum time that it takes for a message to be fully disseminated
in the GossipSub network.</li>
<li>Clock asynchrony <code>Clock_Asynchrony</code>:
The maximum difference between the Unix epoch clocks perceived
by network peers which can be due to clock drifts.</li>
</ul>
<p>With a reasonable approximation of the preceding values,
one can set <code>max_epoch_gap</code> as</p>
<p><code>max_epoch_gap</code>
$= \lceil \frac{\text{Network Delay} + \text{Clock Asynchrony}}{\text{Epoch Length}}\rceil$
where  <code>period</code>  is the length of the <code>epoch</code> in seconds.
<code>Network_Delay</code> and <code>Clock_Asynchrony</code> MUST have the same resolution as  <code>period</code>.
By this formulation, <code>max_epoch_gap</code> indeed measures the maximum number of <code>epoch</code>s
that can elapse since a message gets routed from its origin
to all the other peers in the network.</p>
<p><code>acceptable_root_window_size</code> depends upon the underlying chain's average blocktime,
<code>block_time</code></p>
<p>The lower bound for the <code>acceptable_root_window_size</code> SHOULD be set as $acceptable_root_window_size=(Network_Delay)/block_time$</p>
<p><code>Network_Delay</code> MUST have the same resolution as <code>block_time</code>.</p>
<p>By this formulation,
<code>acceptable_root_window_size</code> will provide a lower bound
of how many roots can be acceptable by a routing peer.</p>
<p>The <code>acceptable_root_window_size</code> should indicate how many blocks may have been mined
during the time it takes for a peer to receive a message.
This formula represents a lower bound of the number of acceptable roots.</p>
<h2 id="copyright"><a class="header" href="#copyright">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ol>
<li><a href="../11/relay.html"><code>11/WAKU2-RELAY</code></a></li>
<li><a href="../64/network.html">64/WAKU-NETWORK</a></li>
<li><a href="../../../../vac/32/rln-v1.html">RLN</a></li>
<li><a href="../14/message.html">14/WAKU2-MESSAGE</a></li>
<li><a href="https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?view">RLN documentation</a></li>
<li><a href="https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?view#Public-Inputs">Public inputs to the RLN circuit</a></li>
<li><a href="https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?view#Linear-Equation-amp-SSS">Shamir secret sharing scheme used in RLN</a></li>
<li><a href="https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?view#Nullifiers">RLN internal nullifier</a></li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../../waku/standards/core/15/bridge.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../../waku/standards/core/19/lightpush.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../../waku/standards/core/15/bridge.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../../waku/standards/core/19/lightpush.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../../elasticlunr.min.js"></script>
        <script src="../../../../mark.min.js"></script>
        <script src="../../../../searcher.js"></script>

        <script src="../../../../clipboard.min.js"></script>
        <script src="../../../../highlight.js"></script>
        <script src="../../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
