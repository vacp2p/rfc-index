<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CODEX-MERKLE-TREE - Logos LIP</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/fonts/fonts.css">
        <link rel="stylesheet" href="../../theme/FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../custom.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../index.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../../about.html">About</a></li><li class="chapter-item expanded "><a href="../../messaging/index.html"><strong aria-hidden="true">1.</strong> Messaging</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../messaging/standards/core/index.html"><strong aria-hidden="true">1.1.</strong> Standards - Core</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../messaging/standards/core/10/waku2.html"><strong aria-hidden="true">1.1.1.</strong> 10/WAKU2</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/11/relay.html"><strong aria-hidden="true">1.1.2.</strong> 11/WAKU2-RELAY</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/12/filter.html"><strong aria-hidden="true">1.1.3.</strong> 12/WAKU2-FILTER</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../messaging/standards/core/12/previous-versions/00/filter.html"><strong aria-hidden="true">1.1.3.1.</strong> 00 (previous)</a></li></ol></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/13/store.html"><strong aria-hidden="true">1.1.4.</strong> 13/WAKU2-STORE</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../messaging/standards/core/13/previous-versions/00/store.html"><strong aria-hidden="true">1.1.4.1.</strong> 00 (previous)</a></li></ol></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/14/message.html"><strong aria-hidden="true">1.1.5.</strong> 14/WAKU2-MESSAGE</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/15/bridge.html"><strong aria-hidden="true">1.1.6.</strong> 15/WAKU-BRIDGE</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/17/rln-relay.html"><strong aria-hidden="true">1.1.7.</strong> 17/WAKU2-RLN-RELAY</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/19/lightpush.html"><strong aria-hidden="true">1.1.8.</strong> 19/WAKU2-LIGHTPUSH</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/31/enr.html"><strong aria-hidden="true">1.1.9.</strong> 31/WAKU2-ENR</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/33/discv5.html"><strong aria-hidden="true">1.1.10.</strong> 33/WAKU2-DISCV5</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/34/peer-exchange.html"><strong aria-hidden="true">1.1.11.</strong> 34/WAKU2-PEER-EXCHANGE</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/36/bindings-api.html"><strong aria-hidden="true">1.1.12.</strong> 36/WAKU2-BINDINGS-API</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/64/network.html"><strong aria-hidden="true">1.1.13.</strong> 64/WAKU2-NETWORK</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/core/66/metadata.html"><strong aria-hidden="true">1.1.14.</strong> 66/WAKU2-METADATA</a></li></ol></li><li class="chapter-item expanded "><a href="../../messaging/standards/application/index.html"><strong aria-hidden="true">1.2.</strong> Standards - Application</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../messaging/standards/application/20/toy-eth-pm.html"><strong aria-hidden="true">1.2.1.</strong> 20/TOY-ETH-PM</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/application/26/payload.html"><strong aria-hidden="true">1.2.2.</strong> 26/WAKU2-PAYLOAD</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/application/53/x3dh.html"><strong aria-hidden="true">1.2.3.</strong> 53/WAKU2-X3DH</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/application/54/x3dh-sessions.html"><strong aria-hidden="true">1.2.4.</strong> 54/WAKU2-X3DH-SESSIONS</a></li></ol></li><li class="chapter-item expanded "><a href="../../messaging/standards/legacy/index.html"><strong aria-hidden="true">1.3.</strong> Standards - Legacy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../messaging/standards/legacy/6/waku1.html"><strong aria-hidden="true">1.3.1.</strong> 6/WAKU1</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/legacy/7/data.html"><strong aria-hidden="true">1.3.2.</strong> 7/WAKU-DATA</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/legacy/8/mail.html"><strong aria-hidden="true">1.3.3.</strong> 8/WAKU-MAIL</a></li><li class="chapter-item expanded "><a href="../../messaging/standards/legacy/9/rpc.html"><strong aria-hidden="true">1.3.4.</strong> 9/WAKU-RPC</a></li></ol></li><li class="chapter-item expanded "><a href="../../messaging/informational/index.html"><strong aria-hidden="true">1.4.</strong> Informational</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../messaging/informational/22/toy-chat.html"><strong aria-hidden="true">1.4.1.</strong> 22/TOY-CHAT</a></li><li class="chapter-item expanded "><a href="../../messaging/informational/23/topics.html"><strong aria-hidden="true">1.4.2.</strong> 23/WAKU2-TOPICS</a></li><li class="chapter-item expanded "><a href="../../messaging/informational/27/peers.html"><strong aria-hidden="true">1.4.3.</strong> 27/WAKU2-PEERS</a></li><li class="chapter-item expanded "><a href="../../messaging/informational/29/config.html"><strong aria-hidden="true">1.4.4.</strong> 29/WAKU2-CONFIG</a></li><li class="chapter-item expanded "><a href="../../messaging/informational/30/adaptive-nodes.html"><strong aria-hidden="true">1.4.5.</strong> 30/ADAPTIVE-NODES</a></li></ol></li><li class="chapter-item expanded "><a href="../../messaging/deprecated/index.html"><strong aria-hidden="true">1.5.</strong> Deprecated</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../messaging/deprecated/5/waku0.html"><strong aria-hidden="true">1.5.1.</strong> 5/WAKU0</a></li><li class="chapter-item expanded "><a href="../../messaging/deprecated/16/rpc.html"><strong aria-hidden="true">1.5.2.</strong> 16/WAKU2-RPC</a></li><li class="chapter-item expanded "><a href="../../messaging/deprecated/18/swap.html"><strong aria-hidden="true">1.5.3.</strong> 18/WAKU2-SWAP</a></li><li class="chapter-item expanded "><a href="../../messaging/deprecated/fault-tolerant-store.html"><strong aria-hidden="true">1.5.4.</strong> 21/WAKU2-FAULT-TOLERANT-STORE</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../blockchain/index.html"><strong aria-hidden="true">2.</strong> Blockchain</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../blockchain/raw/index.html"><strong aria-hidden="true">2.1.</strong> Raw</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../blockchain/raw/bedrock-anonymous-leaders-reward.html"><strong aria-hidden="true">2.1.1.</strong> BEDROCK-ANONYMOUS-LEADERS-REWARD</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/bedrock-genesis-block.html"><strong aria-hidden="true">2.1.2.</strong> BEDROCK-GENESIS-BLOCK</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/bedrock-service-declaration-protocol.html"><strong aria-hidden="true">2.1.3.</strong> BEDROCK-SERVICE-DECLARATION-PROTOCOL</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/bedrock-service-reward-distribution.html"><strong aria-hidden="true">2.1.4.</strong> BEDROCK-SERVICE-REWARD-DISTRIBUTION</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/bedrock-v1.1-block-construction.html"><strong aria-hidden="true">2.1.5.</strong> BEDROCK-V1-1-BLOCK-CONSTRUCTION</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/bedrock-v1.1-mantle-specification.html"><strong aria-hidden="true">2.1.6.</strong> BEDROCK-V1.1-MANTLE-SPECIFICATION</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/cryptarchia-proof-of-leadership.html"><strong aria-hidden="true">2.1.7.</strong> CRYPTARCHIA-PROOF-OF-LEADERSHIP</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/cryptarchia-total-stake-inference.html"><strong aria-hidden="true">2.1.8.</strong> CRYPTARCHIA-TOTAL-STAKE-INFERENCE</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/cryptarchia-v1-bootstr-sync.html"><strong aria-hidden="true">2.1.9.</strong> CRYPTARCHIA-V1-BOOTSTRAPPING-SYNCHRONIZATION</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/nomos-blend-protocol.html"><strong aria-hidden="true">2.1.10.</strong> NOMOS-BLEND-PROTOCOL</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/nomos-cryptarchia-v1-protocol.html"><strong aria-hidden="true">2.1.11.</strong> NOMOS-CRYPTARCHIA-V1-PROTOCOL</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/nomosda-network.html"><strong aria-hidden="true">2.1.12.</strong> NOMOS-DA-NETWORK</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/nomos-key-types-and-generation.html"><strong aria-hidden="true">2.1.13.</strong> NOMOS-KEY-TYPES-GENERATION</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/nomos-message-encapsulation.html"><strong aria-hidden="true">2.1.14.</strong> NOMOS-MESSAGE-ENCAPSULATION</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/nomos-message-formatting.html"><strong aria-hidden="true">2.1.15.</strong> NOMOS-MESSAGE-FORMATTING</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/p2p-network.html"><strong aria-hidden="true">2.1.16.</strong> NOMOS-P2P-NETWORK</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/nomos-payload-formatting.html"><strong aria-hidden="true">2.1.17.</strong> NOMOS-PAYLOAD-FORMATTING</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/nomos-proof-of-quota.html"><strong aria-hidden="true">2.1.18.</strong> NOMOS-PROOF-OF-QUOTA</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/nomosda-encoding.html"><strong aria-hidden="true">2.1.19.</strong> NOMOSDA-ENCODING</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/p2p-hardware-requirements.html"><strong aria-hidden="true">2.1.20.</strong> P2P-HARDWARE-REQUIREMENTS</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/p2p-nat-solution.html"><strong aria-hidden="true">2.1.21.</strong> P2P-NAT-SOLUTION</a></li><li class="chapter-item expanded "><a href="../../blockchain/raw/p2p-network-bootstrapping.html"><strong aria-hidden="true">2.1.22.</strong> P2P-NETWORK-BOOTSTRAPPING</a></li></ol></li><li class="chapter-item expanded "><a href="../../blockchain/deprecated/index.html"><strong aria-hidden="true">2.2.</strong> Deprecated</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../blockchain/deprecated/claro.html"><strong aria-hidden="true">2.2.1.</strong> CONSENSUS-CLARO</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../storage/index.html"><strong aria-hidden="true">3.</strong> Storage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../storage/raw/index.html"><strong aria-hidden="true">3.1.</strong> Raw</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../storage/raw/codex-block-exchange.html"><strong aria-hidden="true">3.1.1.</strong> CODEX-BLOCK-EXCHANGE</a></li><li class="chapter-item expanded "><a href="../../storage/raw/community-history.html"><strong aria-hidden="true">3.1.2.</strong> CODEX-COMMUNITY-HISTORY</a></li><li class="chapter-item expanded "><a href="../../storage/raw/dht.html"><strong aria-hidden="true">3.1.3.</strong> CODEX-DHT</a></li><li class="chapter-item expanded "><a href="../../storage/raw/codex-merkle-tree.html" class="active"><strong aria-hidden="true">3.1.4.</strong> CODEX-MERKLE-TREE</a></li><li class="chapter-item expanded "><a href="../../storage/raw/codex-store.html"><strong aria-hidden="true">3.1.5.</strong> CODEX-STORE</a></li></ol></li><li class="chapter-item expanded "><a href="../../storage/deprecated/index.html"><strong aria-hidden="true">3.2.</strong> Deprecated</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../storage/deprecated/erasure-coding.html"><strong aria-hidden="true">3.2.1.</strong> CODEX-ERASUE-CODING</a></li><li class="chapter-item expanded "><a href="../../storage/deprecated/codex-marketplace.html"><strong aria-hidden="true">3.2.2.</strong> CODEX-MARKETPLACE</a></li><li class="chapter-item expanded "><a href="../../storage/deprecated/codex-prover.html"><strong aria-hidden="true">3.2.3.</strong> CODEX-PROVER</a></li><li class="chapter-item expanded "><a href="../../storage/deprecated/slot-buIlder.html"><strong aria-hidden="true">3.2.4.</strong> CODEX-SLOT-BUILDER</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../ift-ts/index.html"><strong aria-hidden="true">4.</strong> IFT-TS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ift-ts/raw/index.html"><strong aria-hidden="true">4.1.</strong> Raw</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ift-ts/raw/1/coss.html"><strong aria-hidden="true">4.1.1.</strong> 1/COSS</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/2/mvds.html"><strong aria-hidden="true">4.1.2.</strong> 2/MVDS</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/3/remote-log.html"><strong aria-hidden="true">4.1.3.</strong> 3/REMOTE-LOG</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/4/mvds-meta.html"><strong aria-hidden="true">4.1.4.</strong> 4/MVDS-META</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/25/libp2p-dns-discovery.html"><strong aria-hidden="true">4.1.5.</strong> 25/LIBP2P-DNS-DISCOVERY</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/32/rln-v1.html"><strong aria-hidden="true">4.1.6.</strong> 32/RLN-V1</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/decentralized-messaging-ethereum.html"><strong aria-hidden="true">4.1.7.</strong> ETH-DCGKA</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/eth-mls-offchain.html"><strong aria-hidden="true">4.1.8.</strong> ETH-MLS-OFFCHAIN</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/eth-mls-onchain.html"><strong aria-hidden="true">4.1.9.</strong> ETH-MLS-ONCHAIN</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/deleted/eth-secpm.html"><strong aria-hidden="true">4.1.10.</strong> ETH-SECPM</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/extended-kad-disco.html"><strong aria-hidden="true">4.1.11.</strong> EXTENDED-KADEMLIA-DISCOVERY</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/extensible-peer-records.html"><strong aria-hidden="true">4.1.12.</strong> EXTENSIBLE-PEER-RECORDS</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/gossipsub-tor-push.html"><strong aria-hidden="true">4.1.13.</strong> GOSSIPSUB-TOR-PUSH</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/consensus-hashgraphlike.html"><strong aria-hidden="true">4.1.14.</strong> HASHGRAPHLIKE CONSENSUS</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/logos-capability-discovery.html"><strong aria-hidden="true">4.1.15.</strong> LOGOS-CAPABILITY-DISCOVERY</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/mix.html"><strong aria-hidden="true">4.1.16.</strong> MIX</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/multi-message_id-burn-rln.html"><strong aria-hidden="true">4.1.17.</strong> Multi-message_id Burn RLN</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/noise-x3dh-double-ratchet.html"><strong aria-hidden="true">4.1.18.</strong> NOISE-X3DH-DOUBLE-RATCHET</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/mix-spam-protection-rln.html"><strong aria-hidden="true">4.1.19.</strong> RLN DoS Protection for Mixnet</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/rln-interep-spec.html"><strong aria-hidden="true">4.1.20.</strong> RLN-INTEREP-SPEC</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/rln-stealth-commitments.html"><strong aria-hidden="true">4.1.21.</strong> RLN-STEALTH-COMMITMENTS</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/rln-v2.html"><strong aria-hidden="true">4.1.22.</strong> RLN-V2</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/sds.html"><strong aria-hidden="true">4.1.23.</strong> SDS</a></li><li class="chapter-item expanded "><a href="../../ift-ts/raw/zerokit-api.html"><strong aria-hidden="true">4.1.24.</strong> Zerokit API</a></li></ol></li><li class="chapter-item expanded "><a href="../../ift-ts/template.html"><strong aria-hidden="true">4.2.</strong> TEMPLATE</a></li></ol></li><li class="chapter-item expanded "><a href="../../archived/index.html"><strong aria-hidden="true">5.</strong> Archived</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../archived/status/index.html"><strong aria-hidden="true">5.1.</strong> Status</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../archived/status/24/curation.html"><strong aria-hidden="true">5.1.1.</strong> 24/STATUS-CURATION</a></li><li class="chapter-item expanded "><a href="../../archived/status/28/featuring.html"><strong aria-hidden="true">5.1.2.</strong> 28/STATUS-FEATURING</a></li><li class="chapter-item expanded "><a href="../../archived/status/55/1to1-chat.html"><strong aria-hidden="true">5.1.3.</strong> 55/STATUS-1TO1-CHAT</a></li><li class="chapter-item expanded "><a href="../../archived/status/56/communities.html"><strong aria-hidden="true">5.1.4.</strong> 56/STATUS-COMMUNITIES</a></li><li class="chapter-item expanded "><a href="../../archived/status/61/community-history-service.html"><strong aria-hidden="true">5.1.5.</strong> 61/STATUS-Community-History-Service</a></li><li class="chapter-item expanded "><a href="../../archived/status/62/payloads.html"><strong aria-hidden="true">5.1.6.</strong> 62/STATUS-PAYLOADS</a></li><li class="chapter-item expanded "><a href="../../archived/status/63/keycard-usage.html"><strong aria-hidden="true">5.1.7.</strong> 63/STATUS-Keycard-Usage</a></li><li class="chapter-item expanded "><a href="../../archived/status/65/account-address.html"><strong aria-hidden="true">5.1.8.</strong> 65/STATUS-ACCOUNT-ADDRESS</a></li><li class="chapter-item expanded "><a href="../../archived/status/71/push-notification-server.html"><strong aria-hidden="true">5.1.9.</strong> 71/STATUS-PUSH-NOTIFICATION-SERVER</a></li><li class="chapter-item expanded "><a href="../../archived/status/raw/index.html"><strong aria-hidden="true">5.1.10.</strong> Raw</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../archived/status/raw/status-mvds.html"><strong aria-hidden="true">5.1.10.1.</strong> STATUS-MVDS-USAGE</a></li><li class="chapter-item expanded "><a href="../../archived/status/raw/status-app-protocols.html"><strong aria-hidden="true">5.1.10.2.</strong> STATUS-PROTOCOLS</a></li><li class="chapter-item expanded "><a href="../../archived/status/raw/simple-scaling.html"><strong aria-hidden="true">5.1.10.3.</strong> STATUS-SIMPLE-SCALING</a></li><li class="chapter-item expanded "><a href="../../archived/status/raw/url-data.html"><strong aria-hidden="true">5.1.10.4.</strong> STATUS-URL-DATA</a></li><li class="chapter-item expanded "><a href="../../archived/status/raw/url-scheme.html"><strong aria-hidden="true">5.1.10.5.</strong> STATUS-URL-SCHEME</a></li></ol></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/index.html"><strong aria-hidden="true">5.1.11.</strong> Deprecated</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../archived/status/deprecated/3rd-party.html"><strong aria-hidden="true">5.1.11.1.</strong> 3RD-PARTY</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/account.html"><strong aria-hidden="true">5.1.11.2.</strong> ACCOUNT</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/client.html"><strong aria-hidden="true">5.1.11.3.</strong> CLIENT</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/dapp-browser-API-usage.html"><strong aria-hidden="true">5.1.11.4.</strong> Dapp browser API usage</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/eips.html"><strong aria-hidden="true">5.1.11.5.</strong> EIPS</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/ethereum-usage.html"><strong aria-hidden="true">5.1.11.6.</strong> ETHEREUM-USAGE</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/group-chat.html"><strong aria-hidden="true">5.1.11.7.</strong> GROUP-CHAT</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/IPFS-gateway-for-sticker-Pack.html"><strong aria-hidden="true">5.1.11.8.</strong> IPFS-gateway-for-Sticker-Pack</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/keycard-usage-for-wallet-and-chat-keys.html"><strong aria-hidden="true">5.1.11.9.</strong> Keycard Usage for Wallet and Chat Keys</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/notifications.html"><strong aria-hidden="true">5.1.11.10.</strong> NOTIFICATIONS</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/payloads.html"><strong aria-hidden="true">5.1.11.11.</strong> PAYLOADS</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/push-notification-server.html"><strong aria-hidden="true">5.1.11.12.</strong> PUSH-NOTIFICATION-SERVER</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/secure-transport.html"><strong aria-hidden="true">5.1.11.13.</strong> SECURE-TRANSPORT</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/waku-mailserver.html"><strong aria-hidden="true">5.1.11.14.</strong> WAKU-MAILSERVER</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/waku-usage.html"><strong aria-hidden="true">5.1.11.15.</strong> WAKU-USAGE</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/whisper-mailserver.html"><strong aria-hidden="true">5.1.11.16.</strong> WHISPER-MAILSERVER</a></li><li class="chapter-item expanded "><a href="../../archived/status/deprecated/whisper-usage.html"><strong aria-hidden="true">5.1.11.17.</strong> WHISPER-USAGE</a></li></ol></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Logos LIP</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/vacp2p/rfc-index" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="codex-merkle-tree"><a class="header" href="#codex-merkle-tree">CODEX-MERKLE-TREE</a></h1>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody>
<tr><td>Name</td><td>Codex Merkle Tree</td></tr>
<tr><td>Slug</td><td>82</td></tr>
<tr><td>Status</td><td>raw</td></tr>
<tr><td>Category</td><td>Standards Track</td></tr>
<tr><td>Editor</td><td>Codex Team</td></tr>
<tr><td>Contributors</td><td>Filip Dimitrijevic <a href="mailto:filip@status.im">filip@status.im</a></td></tr>
</tbody></table>
</div><!-- timeline:start -->
<h2 id="timeline"><a class="header" href="#timeline">Timeline</a></h2>
<ul>
<li><strong>2026-01-19</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/f24e567d0b1e10c178bfa0c133495fe83b969b76/docs/storage/raw/codex-merkle-tree.md"><code>f24e567</code></a> — Chore/updates mdbook (#262)</li>
<li><strong>2026-01-16</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/89f2ea89fc1d69ab238b63c7e6fb9e4203fd8529/docs/storage/raw/codex-merkle-tree.md"><code>89f2ea8</code></a> — Chore/mdbook updates (#258)</li>
</ul>
<!-- timeline:end -->
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>This specification defines the Merkle tree implementation
for <a href="https://github.com/codex-storage/nim-codex">Codex</a>.
The purpose of this component is to deal with Merkle trees
(and Merkle trees only;
except that certain arithmetic hashes constructed via the sponge construction
use the same encoding standards).</p>
<h2 id="background--rationale--motivation"><a class="header" href="#background--rationale--motivation">Background / Rationale / Motivation</a></h2>
<p>Merkle trees and Merkle tree roots are used for:</p>
<ul>
<li>content addressing (via the Merkle root hash)</li>
<li>data authenticity (via a Merkle path from a block to the root)</li>
<li>remote auditing (via Merkle proofs of pieces)</li>
</ul>
<p>Merkle trees can be implemented in quite a few different ways,
and if naively implemented, can be also attacked in several ways.</p>
<p>Some possible attacks:</p>
<ul>
<li><strong>Data encoding attacks</strong>: occur when different byte sequences
can be encoded to the same target type, potentially creating collisions</li>
<li><strong>Padding attacks</strong>: occur when different data
can be padded to produce identical hashes</li>
<li><strong>Layer abusing attacks</strong>: occur when nodes from different layers
can be substituted or confused with each other</li>
</ul>
<p>These all can create root hash collisions for example.</p>
<p>Hence, a concrete implementation is specified
which should be safe from these attacks through:</p>
<ol>
<li><strong>Injective encoding</strong>: The <code>10*</code> padding strategy ensures
that different byte sequences always encode to different target types</li>
<li><strong>Keyed compression</strong>: Using distinct keys for different node types
(even/odd, bottom/other layers) prevents node substitution attacks</li>
<li><strong>Deterministic construction</strong>: The layer-by-layer construction
with explicit handling of singleton nodes ensures consistent tree building</li>
</ol>
<p>The specification supports multiple hash function types
(SHA256, Poseidon2, Goldilocks)
while maintaining these security properties across all implementations.</p>
<p>Storing Merkle trees on disc is out of scope here
(but should be straightforward,
as serialization of trees should be included in the component).</p>
<h2 id="theory--semantics"><a class="header" href="#theory--semantics">Theory / Semantics</a></h2>
<h2 id="vocabulary"><a class="header" href="#vocabulary">Vocabulary</a></h2>
<p>A Merkle tree, built on a hash function <code>H</code>,
produces a Merkle root of type <code>T</code> ("Target type").
This is usually the same type as the output of the hash function
(this is assumed below).
Some examples:</p>
<ul>
<li>SHA1: <code>T</code> is 160 bits</li>
<li>SHA256: <code>T</code> is 256 bits</li>
<li>Keccak (SHA3): <code>T</code> can be one of 224, 256, 384 or 512 bits</li>
<li>Poseidon: <code>T</code> is one or more finite field element(s) (based on the field size)</li>
<li>Monolith: <code>T</code> is 4 <a href="https://github.com/codex-storage/nim-goldilocks-hash">Goldilocks</a> field elements</li>
</ul>
<p>The hash function <code>H</code> can also have different types <code>S</code> ("Source type") of inputs.
For example:</p>
<ul>
<li>SHA1 / SHA256 / SHA3: <code>S</code> is an arbitrary sequence of bits</li>
<li>some less-conforming implementation of these
could take a sequence of bytes instead (but that's often enough in practice)</li>
<li>binary compression function: <code>S</code> is a pair of <code>T</code>-s</li>
<li>Poseidon: <code>S</code> is a sequence of finite field elements</li>
<li><a href="https://github.com/codex-storage/nim-poseidon2">Poseidon2</a> compression function:
<code>S</code> is at most <code>t-k</code> field elements,
where <code>k</code> field elements should be approximately 256 bits
(in our case <code>t=3</code>, <code>k=1</code> for BN254 field;
or <code>t=12</code>, <code>k=4</code> for the <a href="https://github.com/codex-storage/nim-goldilocks-hash">Goldilocks</a> field;
or <code>t=24</code>, <code>k=8</code> for a ~32 bit field)</li>
<li>as an alternative,
the "<a href="https://eprint.iacr.org/2022/840">Jive compression mode</a>" for binary compression
can eliminate the "minus <code>k</code>" requirement (you can compress <code>t</code> into <code>t/2</code>)</li>
<li>A naive Merkle tree implementation could for example
accept only a power-of-two sized sequence of <code>T</code></li>
</ul>
<p>Notation: Let's denote a sequence of <code>T</code>-s by <code>[T]</code>;
and an array of <code>T</code>-s of length <code>l</code> by <code>T[l]</code>.</p>
<h2 id="data-models"><a class="header" href="#data-models">Data Models</a></h2>
<ul>
<li><code>H</code>, the set of supported hash functions, is an enumeration</li>
<li><code>S := Source[H]</code> and <code>T := Target[H]</code></li>
<li><code>MerklePath[H]</code> is a record, consisting of
<ul>
<li><code>path</code>: a sequence of <code>T</code>-s</li>
<li><code>index</code>: a linear index (int)</li>
<li><code>leaf</code>: the leaf being proved (a <code>T</code>)</li>
<li><code>size</code>: the number of elements from which the tree was created</li>
</ul>
</li>
<li><code>MerkleTree[H]</code>: a binary tree of <code>T</code>-s;
alternatively a sequence of sequences of <code>T</code>-s</li>
</ul>
<h2 id="tree-construction"><a class="header" href="#tree-construction">Tree Construction</a></h2>
<p>We want to avoid the following kind of attacks:</p>
<ul>
<li>padding attacks</li>
<li>layer abusing attacks</li>
</ul>
<p>Hence, instead of using a single compression functions,
a <em>keyed compression function</em> is used, which is keyed by two bits:</p>
<ul>
<li>whether the new parent node is an even or odd node
(that is, has 2 or 1 children;
alternatively, whether compressing 2 or 1 nodes)</li>
<li>whether it's the bottom (the widest, initial) layer or not</li>
</ul>
<p>This information is converted to a number <code>0 &lt;= key &lt; 4</code>
by the following algorithm:</p>
<pre><code class="language-haskell">data LayerFlag
  = BottomLayer   -- ^ it's the bottom (initial, widest) layer
  | OtherLayer    -- ^ it's not the bottom layer

data NodeParity
  = EvenNode      -- ^ it has 2 children
  | OddNode       -- ^ it has 1 child

-- | Key based on the node type:
--
-- &gt; bit0 := 1 if bottom layer, 0 otherwise
-- &gt; bit1 := 1 if odd, 0 if even
--
nodeKey :: LayerFlag -&gt; NodeParity -&gt; Int
nodeKey OtherLayer  EvenNode = 0x00
nodeKey BottomLayer EvenNode = 0x01
nodeKey OtherLayer  OddNode  = 0x02
nodeKey BottomLayer OddNode  = 0x03
</code></pre>
<p>This number is used to key the compression function
(essentially, 4 completely different compression functions).</p>
<p>When the hash function is a finite field sponge based,
like <a href="https://github.com/codex-storage/nim-poseidon2">Poseidon2</a> or Monolith,
the following construction is used:
The permutation function is applied to <code>(x,y,key)</code>,
and the first component of the result is taken.</p>
<p>When the hash function is something like SHA256,
the following is done: <code>SHA256(key|x|y)</code> (here <code>key</code> is encoded as a byte).
SHA256 implementation uses <a href="https://bearssl.org/">bearssl</a>.</p>
<p>Remark: Since standard SHA256 includes padding,
adding a key at the beginning doesn't result in extra computation
(it's always two internal hash calls).
However, a faster (twice as fast) alternative would be
to choose 4 different random-looking initialization vectors,
and not do padding.
This would be a non-standard SHA256 invocation.</p>
<p>Finally, the process proceeds from the initial sequence in layers:
Take the previous sequence,
apply the keyed compression function for each consecutive pairs <code>(x,y) : (T,T)</code>
with the correct key:
based on whether this was the initial (bottom) layer,
and whether it's a singleton "pair" <code>x : T</code>,
in which case it's also padded with a zero to <code>(x,0)</code>.</p>
<p>Note: If the input was a singleton list <code>[x]</code>,
one layer is still applied,
so in that case the root will be <code>compress[key=3](x,0)</code>.</p>
<h2 id="encoding-and-deserialization-fromto-bytes"><a class="header" href="#encoding-and-deserialization-fromto-bytes">Encoding and (De)serialization from/to Bytes</a></h2>
<p>This has to be done very carefully to avoid potential attacks.</p>
<p>Note: This is a rather special situation,
in that encoding and serialization are <strong>NOT THE INVERSE OF EACH OTHER</strong>.
The reason for this is that they have different purposes:
In case of encoding from bytes to <code>T</code>-s,
it MUST BE injective to avoid trivial collision attacks;
while when serializing from <code>T</code>-s to bytes,
it needs to be invertible
(so that what is stored on disk can be loaded back;
in this sense this is really 1+2 = 3 algorithms).</p>
<p>The two can coincide when <code>T</code> is just a byte sequence like in SHA256,
but not when <code>T</code> consists of prime field elements.</p>
<p>Remark: The same encoding of sequence of bytes to sequence of <code>T</code>-s
is used for the sponge hash construction, when applicable.</p>
<h3 id="encoding-into-a-single-t"><a class="header" href="#encoding-into-a-single-t">Encoding into a Single T</a></h3>
<p>For any <code>T = Target[H]</code>,
fix a size <code>M</code> and an injective encoding <code>byte[M] -&gt; T</code>.
For SHA256 etc, this will be standard encoding (big-endian; <code>M=32</code>).</p>
<p>For the BN254 field (<code>T</code> is 1 field element),
<code>M=31</code>, and the 31 bytes interpreted as a <em>little-endian</em> integer modulo <code>p</code>.</p>
<p>For the <a href="https://github.com/codex-storage/nim-goldilocks-hash">Goldilocks</a> field,
there are some choices:
<code>M=4*7=28</code> can be used, as a single field element can encode 7 bytes but not 8.
Or, for more efficiency,
<code>M=31</code> can still be achieved by storing 62 bits in each field element.
For this some convention needs to be chosen;
the implementation is the following:</p>
<pre><code class="language-c">#define MASK 0x3fffffffffffffffULL

// NOTE: we assume a little-endian architecture here
void goldilocks_convert_31_bytes_to_4_field_elements(const uint8_t *ptr, uint64_t *felts) {
  const uint64_t *q0  = (const uint64_t*)(ptr   );
  const uint64_t *q7  = (const uint64_t*)(ptr+ 7);
  const uint64_t *q15 = (const uint64_t*)(ptr+15);
  const uint64_t *q23 = (const uint64_t*)(ptr+23);

  felts[0] =  (q0 [0]) &amp; MASK;
  felts[1] = ((q7 [0]) &gt;&gt; 6) | ((uint64_t)(ptr[15] &amp; 0x0f) &lt;&lt; 58);
  felts[2] = ((q15[0]) &gt;&gt; 4) | ((uint64_t)(ptr[23] &amp; 0x03) &lt;&lt; 60);
  felts[3] = ((q23[0]) &gt;&gt; 2);
}
</code></pre>
<p>This simply chunks the 31 bytes = 248 bits into 62 bits chunks,
and interprets them as little endian 62 bit integers.</p>
<h3 id="encoding-from-a-sequence-of-bytes"><a class="header" href="#encoding-from-a-sequence-of-bytes">Encoding from a Sequence of Bytes</a></h3>
<p>First, the <em>byte sequence</em> is padded with the <code>10*</code> padding strategy
to a multiple of <code>M</code> bytes.</p>
<p>This means that a <code>0x01</code> byte is <em>always</em> added,
and then as many <code>0x00</code> bytes as required for the length to be divisible by <code>M</code>.
If the input was <code>l</code> bytes,
then the padded sequence will have <code>M*(floor(l/M)+1)</code> bytes.</p>
<p>Note: the <code>10*</code> padding strategy is an invertible operation,
which will ensure that there is no collision
between sequences of different length.</p>
<p>This padded byte sequence is then chunked to pieces of <code>M</code> bytes
(so there will be <code>floor(l/M)+1</code> chunks),
and the above fixed <code>byte[M] -&gt; T</code> is applied for each chunk,
resulting in the same number of <code>T</code>-s.</p>
<p>Remark: The sequence of <code>T</code>-s is not padded
when constructing the Merkle tree
(as the tree construction ensures
that different lengths will result in different root hashes).
However, when <strong>using the sponge construction,</strong>
the sequence of <code>T</code>-s needs to be further padded
to be a multiple of the sponge rate;
there again the <code>10*</code> strategy is applied,
but there the <code>1</code> and <code>0</code> are finite field elements.</p>
<h3 id="serializing--deserializing"><a class="header" href="#serializing--deserializing">Serializing / Deserializing</a></h3>
<p>When using SHA256 or similar,
this is trivial (use the standard, big-endian encoding).</p>
<p>When <code>T</code> consists of prime field elements,
simply take the smallest number of bytes the field fits in
(usually 256, 64 or 32 bits, that is 32, 8 or 4 bytes),
and encode as a little-endian integer (mod the prime).</p>
<p>This is obvious to invert.</p>
<h3 id="tree-serialization"><a class="header" href="#tree-serialization">Tree Serialization</a></h3>
<p>Just add enough metadata that the size of each layer is known,
then the layers can simply be concatenated,
and serialized as above.
This metadata can be as small as the size of the initial layer,
that is, a single integer.</p>
<h2 id="wire-format-specification--syntax"><a class="header" href="#wire-format-specification--syntax">Wire Format Specification / Syntax</a></h2>
<h2 id="interfaces"><a class="header" href="#interfaces">Interfaces</a></h2>
<p>At least two types of Merkle tree APIs are usually needed:</p>
<ul>
<li>one which takes a sequence <code>S = [T]</code> of length <code>n</code> as input,
and produces an output (Merkle root) of type <code>T</code></li>
<li>and one which takes a sequence of bytes
(or even bits, but in practice only bytes are probably needed): <code>S = [byte]</code></li>
</ul>
<p>The latter can be decomposed into the composition
of an <code>encodeBytes</code> function and the former
(it's safer this way, because there are a lot of subtle details here).</p>
<div class="table-wrapper"><table><thead><tr><th>Interface</th><th>Description</th><th>Input</th><th>Output</th></tr></thead><tbody>
<tr><td>computeTree()</td><td>computes the full Merkle tree</td><td>sequence of <code>T</code>-s</td><td>a MerkleTree[T] data structure (a binary tree)</td></tr>
<tr><td>computeRoot()</td><td>computes the Merkle root of a sequence of <code>T</code>-s</td><td>sequence of <code>T</code>-s</td><td>a single <code>T</code></td></tr>
<tr><td>extractPath()</td><td>computes a Merkle path</td><td>MerkleTree[T] and a leaf index</td><td>MerklePath[T]</td></tr>
<tr><td>checkMerkleProof()</td><td>checks the validity of a Merkle path proof</td><td>root hash (a <code>T</code>) and MerklePath[T]</td><td>a bool (ok or not)</td></tr>
<tr><td>encodeBytesInjective()</td><td>converts a sequence of bytes into a sequence of <code>T</code>-s, injectively</td><td>seqences of bytes</td><td>sequence of <code>T</code>-s</td></tr>
<tr><td>serializeToBytes()</td><td>serializes a sequence of <code>T</code>-s into bytes</td><td>sequence of <code>T</code>-s</td><td>sequence of bytes</td></tr>
<tr><td>deserializeFromBytes()</td><td>deserializes a sequence of <code>T</code>-s from bytes</td><td>sequence of bytes</td><td>sequence of <code>T</code>-s, or error</td></tr>
<tr><td>serializeTree()</td><td>serializes the Merkle tree data structure (to be stored on disk)</td><td>MerkleTree[T]</td><td>sequence of bytes</td></tr>
<tr><td>deserializeTree()</td><td>deserializes the Merkle tree data structure (to be load from disk)</td><td>sequence of bytes</td><td>error or MerkleTree[T]</td></tr>
</tbody></table>
</div>
<h2 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h2>
<p>Hash function implementations, for example:</p>
<ul>
<li><a href="https://bearssl.org/">bearssl</a> (for SHA256)</li>
<li><a href="https://github.com/codex-storage/nim-poseidon2">nim-poseidon2</a> (which should be renamed to <code>nim-poseidon2-bn254</code>)</li>
<li><a href="https://github.com/codex-storage/nim-goldilocks-hash">nim-goldilocks-hash</a></li>
</ul>
<h2 id="securityprivacy-considerations"><a class="header" href="#securityprivacy-considerations">Security/Privacy Considerations</a></h2>
<h3 id="attack-mitigation"><a class="header" href="#attack-mitigation">Attack Mitigation</a></h3>
<p>The specification addresses three major attack vectors:</p>
<ol>
<li>
<p><strong>Data encoding attacks</strong>: Prevented by using injective encoding
from bytes to target types with the <code>10*</code> padding strategy.
The strategy always adds a <code>0x01</code> byte followed by <code>0x00</code> bytes
to reach a multiple of <code>M</code> bytes,
ensuring that different byte sequences of different lengths
cannot encode to the same target type.</p>
</li>
<li>
<p><strong>Padding attacks</strong>: Prevented by the keyed compression function
that distinguishes between even and odd nodes.
When a node has only one child (odd node),
it is padded with zero to form a pair <code>(x,0)</code>,
but the compression function uses a different key (0x02 or 0x03)
than for even nodes (0x00 or 0x01),
preventing confusion between padded and non-padded nodes.</p>
</li>
<li>
<p><strong>Layer abusing attacks</strong>: Prevented by the keyed compression function
that distinguishes between bottom layer and other layers.
The bottom layer uses keys with bit0 set to 1 (0x01 or 0x03),
while other layers use keys with bit0 set to 0 (0x00 or 0x02),
preventing nodes from different layers from producing identical hashes.</p>
</li>
</ol>
<h3 id="keyed-compression-function"><a class="header" href="#keyed-compression-function">Keyed Compression Function</a></h3>
<p>The keyed compression function uses four distinct keys
(0x00, 0x01, 0x02, 0x03) based on two bits:</p>
<ul>
<li><strong>bit0</strong>: Set to 1 if bottom layer, 0 otherwise</li>
<li><strong>bit1</strong>: Set to 1 if odd node (1 child), 0 if even node (2 children)</li>
</ul>
<p>This ensures that different structural positions in the tree
cannot produce hash collisions, as:</p>
<ul>
<li>For finite field sponge hash functions (Poseidon2, Monolith):
The permutation is applied to <code>(x,y,key)</code> and the first component is extracted</li>
<li>For standard hash functions (SHA256):
The hash is computed as <code>SHA256(key|x|y)</code> where <code>key</code> is encoded as a byte</li>
</ul>
<h3 id="hash-function-flexibility"><a class="header" href="#hash-function-flexibility">Hash Function Flexibility</a></h3>
<p>The specification is parametrized by the hash function,
allowing different implementations to use appropriate hash functions
for their context while maintaining consistent security properties.
All supported hash functions must maintain the injective encoding property
and support the keyed compression function pattern.</p>
<h2 id="rationale"><a class="header" href="#rationale">Rationale</a></h2>
<h3 id="keyed-compression-design"><a class="header" href="#keyed-compression-design">Keyed Compression Design</a></h3>
<p>The use of a keyed compression function with four distinct keys
is the primary defense mechanism against theoretical attacks.
By encoding both the layer position (bottom vs. other)
and node parity (even vs. odd) into the compression function,
the design ensures that:</p>
<ul>
<li>Nodes at different layers cannot be confused</li>
<li>Even and odd nodes produce different hashes even with the same input data</li>
<li>Padding attacks are prevented by distinguishing singleton nodes from pair nodes</li>
</ul>
<h3 id="encoding-vs-serialization-separation"><a class="header" href="#encoding-vs-serialization-separation">Encoding vs. Serialization Separation</a></h3>
<p>The specification explicitly separates encoding and serialization
as distinct operations:</p>
<ul>
<li><strong>Encoding</strong> (bytes to <code>T</code>-s) must be injective to prevent collision attacks</li>
<li><strong>Serialization</strong> (<code>T</code>-s to bytes) must be invertible to enable storage and retrieval</li>
</ul>
<p>This separation is necessary because they serve different purposes.
The two operations only coincide when <code>T</code> is a byte sequence (as in SHA256),
but differ when <code>T</code> consists of prime field elements.</p>
<h3 id="10-padding-strategy"><a class="header" href="#10-padding-strategy">10* Padding Strategy</a></h3>
<p>The <code>10*</code> padding strategy
(always adding <code>0x01</code> followed by <code>0x00</code> bytes)
is an invertible operation
that ensures no collision between sequences of different lengths.
This is applied at the byte level before chunking into <code>M</code>-byte pieces.</p>
<h3 id="parametrized-hash-function-design"><a class="header" href="#parametrized-hash-function-design">Parametrized Hash Function Design</a></h3>
<p>The design is parametrized by the hash function, supporting:</p>
<ul>
<li>Standard hash functions (SHA256, SHA3)</li>
<li>Finite field-based sponge constructions
(<a href="https://github.com/codex-storage/nim-poseidon2">Poseidon2</a>, Monolith)</li>
<li>Binary compression functions</li>
</ul>
<p>This flexibility allows easy addition of new hash functions
while maintaining security guarantees.</p>
<h2 id="copyright"><a class="header" href="#copyright">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<h3 id="normative"><a class="header" href="#normative">normative</a></h3>
<ul>
<li><strong>Codex Merkle Tree Implementation</strong>: <a href="https://github.com/codex-storage/nim-codex">GitHub - codex-storage/nim-codex</a></li>
</ul>
<h3 id="informative"><a class="header" href="#informative">informative</a></h3>
<ul>
<li><strong>Merkle Tree Conventions</strong>: <a href="https://github.com/codex-storage/codex-storage-proofs-circuits/blob/master/README.md#merkle-tree-conventions">GitHub - codex-storage-proofs-circuits</a> - Merkle tree specification in codex-storage-proofs-circuits</li>
<li><strong>nim-poseidon2</strong>: <a href="https://github.com/codex-storage/nim-poseidon2">GitHub - codex-storage/nim-poseidon2</a> - Poseidon2 hash function for BN254</li>
<li><strong>nim-goldilocks-hash</strong>: <a href="https://github.com/codex-storage/nim-goldilocks-hash">GitHub - codex-storage/nim-goldilocks-hash</a> - Goldilocks field hash functions</li>
<li><strong>BearSSL</strong>: <a href="https://bearssl.org/">bearssl.org</a> - BearSSL cryptographic library</li>
<li><strong>Jive Compression Mode</strong>: <a href="https://eprint.iacr.org/2022/840">Anemoi Permutations and Jive Compression Mode</a> - Efficient arithmetization-oriented hash functions</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../storage/raw/dht.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../storage/raw/codex-store.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../storage/raw/dht.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../storage/raw/codex-store.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../scripts/rfc-index.js"></script>


    </div>
    </body>
</html>
