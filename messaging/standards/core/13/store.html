<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>13/WAKU2-STORE - Logos LIP</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../../favicon.svg">
        <link rel="shortcut icon" href="../../../../favicon.png">
        <link rel="stylesheet" href="../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../css/general.css">
        <link rel="stylesheet" href="../../../../css/chrome.css">
        <link rel="stylesheet" href="../../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../../highlight.css">
        <link rel="stylesheet" href="../../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../../theme/fonts/fonts.css">
        <link rel="stylesheet" href="../../../../theme/FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../../custom.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../../../index.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../../../../about.html">About</a></li><li class="chapter-item expanded "><a href="../../../../messaging/index.html"><strong aria-hidden="true">1.</strong> Messaging</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/index.html"><strong aria-hidden="true">1.1.</strong> Standards - Core</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/10/waku2.html"><strong aria-hidden="true">1.1.1.</strong> 10/WAKU2</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/11/relay.html"><strong aria-hidden="true">1.1.2.</strong> 11/WAKU2-RELAY</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/12/filter.html"><strong aria-hidden="true">1.1.3.</strong> 12/WAKU2-FILTER</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/12/previous-versions/00/filter.html"><strong aria-hidden="true">1.1.3.1.</strong> 00 (previous)</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/13/store.html" class="active"><strong aria-hidden="true">1.1.4.</strong> 13/WAKU2-STORE</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/13/previous-versions/00/store.html"><strong aria-hidden="true">1.1.4.1.</strong> 00 (previous)</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/14/message.html"><strong aria-hidden="true">1.1.5.</strong> 14/WAKU2-MESSAGE</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/15/bridge.html"><strong aria-hidden="true">1.1.6.</strong> 15/WAKU-BRIDGE</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/17/rln-relay.html"><strong aria-hidden="true">1.1.7.</strong> 17/WAKU2-RLN-RELAY</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/19/lightpush.html"><strong aria-hidden="true">1.1.8.</strong> 19/WAKU2-LIGHTPUSH</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/31/enr.html"><strong aria-hidden="true">1.1.9.</strong> 31/WAKU2-ENR</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/33/discv5.html"><strong aria-hidden="true">1.1.10.</strong> 33/WAKU2-DISCV5</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/34/peer-exchange.html"><strong aria-hidden="true">1.1.11.</strong> 34/WAKU2-PEER-EXCHANGE</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/36/bindings-api.html"><strong aria-hidden="true">1.1.12.</strong> 36/WAKU2-BINDINGS-API</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/64/network.html"><strong aria-hidden="true">1.1.13.</strong> 64/WAKU2-NETWORK</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/core/66/metadata.html"><strong aria-hidden="true">1.1.14.</strong> 66/WAKU2-METADATA</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/application/index.html"><strong aria-hidden="true">1.2.</strong> Standards - Application</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../messaging/standards/application/20/toy-eth-pm.html"><strong aria-hidden="true">1.2.1.</strong> 20/TOY-ETH-PM</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/application/26/payload.html"><strong aria-hidden="true">1.2.2.</strong> 26/WAKU2-PAYLOAD</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/application/53/x3dh.html"><strong aria-hidden="true">1.2.3.</strong> 53/WAKU2-X3DH</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/application/54/x3dh-sessions.html"><strong aria-hidden="true">1.2.4.</strong> 54/WAKU2-X3DH-SESSIONS</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/legacy/index.html"><strong aria-hidden="true">1.3.</strong> Standards - Legacy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../messaging/standards/legacy/6/waku1.html"><strong aria-hidden="true">1.3.1.</strong> 6/WAKU1</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/legacy/7/data.html"><strong aria-hidden="true">1.3.2.</strong> 7/WAKU-DATA</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/legacy/8/mail.html"><strong aria-hidden="true">1.3.3.</strong> 8/WAKU-MAIL</a></li><li class="chapter-item expanded "><a href="../../../../messaging/standards/legacy/9/rpc.html"><strong aria-hidden="true">1.3.4.</strong> 9/WAKU-RPC</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../messaging/informational/index.html"><strong aria-hidden="true">1.4.</strong> Informational</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../messaging/informational/22/toy-chat.html"><strong aria-hidden="true">1.4.1.</strong> 22/TOY-CHAT</a></li><li class="chapter-item expanded "><a href="../../../../messaging/informational/23/topics.html"><strong aria-hidden="true">1.4.2.</strong> 23/WAKU2-TOPICS</a></li><li class="chapter-item expanded "><a href="../../../../messaging/informational/27/peers.html"><strong aria-hidden="true">1.4.3.</strong> 27/WAKU2-PEERS</a></li><li class="chapter-item expanded "><a href="../../../../messaging/informational/29/config.html"><strong aria-hidden="true">1.4.4.</strong> 29/WAKU2-CONFIG</a></li><li class="chapter-item expanded "><a href="../../../../messaging/informational/30/adaptive-nodes.html"><strong aria-hidden="true">1.4.5.</strong> 30/ADAPTIVE-NODES</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../messaging/deprecated/index.html"><strong aria-hidden="true">1.5.</strong> Deprecated</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../messaging/deprecated/5/waku0.html"><strong aria-hidden="true">1.5.1.</strong> 5/WAKU0</a></li><li class="chapter-item expanded "><a href="../../../../messaging/deprecated/16/rpc.html"><strong aria-hidden="true">1.5.2.</strong> 16/WAKU2-RPC</a></li><li class="chapter-item expanded "><a href="../../../../messaging/deprecated/18/swap.html"><strong aria-hidden="true">1.5.3.</strong> 18/WAKU2-SWAP</a></li><li class="chapter-item expanded "><a href="../../../../messaging/deprecated/fault-tolerant-store.html"><strong aria-hidden="true">1.5.4.</strong> 21/WAKU2-FAULT-TOLERANT-STORE</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../../../blockchain/index.html"><strong aria-hidden="true">2.</strong> Blockchain</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../blockchain/raw/index.html"><strong aria-hidden="true">2.1.</strong> Raw</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../blockchain/raw/bedrock-anonymous-leaders-reward.html"><strong aria-hidden="true">2.1.1.</strong> BEDROCK-ANONYMOUS-LEADERS-REWARD</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/bedrock-architecture-overview.html"><strong aria-hidden="true">2.1.2.</strong> BEDROCK-ARCHITECTURE-OVERVIEW</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/bedrock-genesis-block.html"><strong aria-hidden="true">2.1.3.</strong> BEDROCK-GENESIS-BLOCK</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/bedrock-service-declaration-protocol.html"><strong aria-hidden="true">2.1.4.</strong> BEDROCK-SERVICE-DECLARATION-PROTOCOL</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/bedrock-service-reward-distribution.html"><strong aria-hidden="true">2.1.5.</strong> BEDROCK-SERVICE-REWARD-DISTRIBUTION</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/bedrock-v1.1-block-construction.html"><strong aria-hidden="true">2.1.6.</strong> BEDROCK-V1-1-BLOCK-CONSTRUCTION</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/bedrock-v1.1-mantle-specification.html"><strong aria-hidden="true">2.1.7.</strong> BEDROCK-V1.1-MANTLE-SPECIFICATION</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/fork-choice.html"><strong aria-hidden="true">2.1.8.</strong> CRYPTARCHIA-FORK-CHOICE</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/cryptarchia-proof-of-leadership.html"><strong aria-hidden="true">2.1.9.</strong> CRYPTARCHIA-PROOF-OF-LEADERSHIP</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/cryptarchia-total-stake-inference.html"><strong aria-hidden="true">2.1.10.</strong> CRYPTARCHIA-TOTAL-STAKE-INFERENCE</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/cryptarchia-v1-bootstr-sync.html"><strong aria-hidden="true">2.1.11.</strong> CRYPTARCHIA-V1-BOOTSTRAPPING-SYNCHRONIZATION</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/nomos-blend-protocol.html"><strong aria-hidden="true">2.1.12.</strong> NOMOS-BLEND-PROTOCOL</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/nomos-cryptarchia-v1-protocol.html"><strong aria-hidden="true">2.1.13.</strong> NOMOS-CRYPTARCHIA-V1-PROTOCOL</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/nomosda-network.html"><strong aria-hidden="true">2.1.14.</strong> NOMOS-DA-NETWORK</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/digital-signature.html"><strong aria-hidden="true">2.1.15.</strong> NOMOS-DIGITAL-SIGNATURE</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/nomos-key-types-and-generation.html"><strong aria-hidden="true">2.1.16.</strong> NOMOS-KEY-TYPES-GENERATION</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/nomos-message-encapsulation.html"><strong aria-hidden="true">2.1.17.</strong> NOMOS-MESSAGE-ENCAPSULATION</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/nomos-message-formatting.html"><strong aria-hidden="true">2.1.18.</strong> NOMOS-MESSAGE-FORMATTING</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/p2p-network.html"><strong aria-hidden="true">2.1.19.</strong> NOMOS-P2P-NETWORK</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/nomos-payload-formatting.html"><strong aria-hidden="true">2.1.20.</strong> NOMOS-PAYLOAD-FORMATTING</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/nomos-proof-of-quota.html"><strong aria-hidden="true">2.1.21.</strong> NOMOS-PROOF-OF-QUOTA</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/da-cryptographic-protocol.html"><strong aria-hidden="true">2.1.22.</strong> NOMOSDA-CRYPTOGRAPHIC-PROTOCOL</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/da-rewarding.html"><strong aria-hidden="true">2.1.23.</strong> NOMOSDA-REWARDING</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/p2p-hardware-requirements.html"><strong aria-hidden="true">2.1.24.</strong> P2P-HARDWARE-REQUIREMENTS</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/p2p-nat-solution.html"><strong aria-hidden="true">2.1.25.</strong> P2P-NAT-SOLUTION</a></li><li class="chapter-item expanded "><a href="../../../../blockchain/raw/p2p-network-bootstrapping.html"><strong aria-hidden="true">2.1.26.</strong> P2P-NETWORK-BOOTSTRAPPING</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../blockchain/deprecated/index.html"><strong aria-hidden="true">2.2.</strong> Deprecated</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../blockchain/deprecated/claro.html"><strong aria-hidden="true">2.2.1.</strong> CONSENSUS-CLARO</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../../../storage/index.html"><strong aria-hidden="true">3.</strong> Storage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../storage/raw/index.html"><strong aria-hidden="true">3.1.</strong> Raw</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../storage/raw/codex-block-exchange.html"><strong aria-hidden="true">3.1.1.</strong> CODEX-BLOCK-EXCHANGE</a></li><li class="chapter-item expanded "><a href="../../../../storage/raw/community-history.html"><strong aria-hidden="true">3.1.2.</strong> CODEX-COMMUNITY-HISTORY</a></li><li class="chapter-item expanded "><a href="../../../../storage/raw/dht.html"><strong aria-hidden="true">3.1.3.</strong> CODEX-DHT</a></li><li class="chapter-item expanded "><a href="../../../../storage/raw/manifest.html"><strong aria-hidden="true">3.1.4.</strong> CODEX-MANIFEST</a></li><li class="chapter-item expanded "><a href="../../../../storage/raw/codex-merkle-tree.html"><strong aria-hidden="true">3.1.5.</strong> CODEX-MERKLE-TREE</a></li><li class="chapter-item expanded "><a href="../../../../storage/raw/codex-store.html"><strong aria-hidden="true">3.1.6.</strong> CODEX-STORE</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../storage/deprecated/index.html"><strong aria-hidden="true">3.2.</strong> Deprecated</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../storage/deprecated/erasure-coding.html"><strong aria-hidden="true">3.2.1.</strong> CODEX-ERASUE-CODING</a></li><li class="chapter-item expanded "><a href="../../../../storage/deprecated/codex-marketplace.html"><strong aria-hidden="true">3.2.2.</strong> CODEX-MARKETPLACE</a></li><li class="chapter-item expanded "><a href="../../../../storage/deprecated/codex-prover.html"><strong aria-hidden="true">3.2.3.</strong> CODEX-PROVER</a></li><li class="chapter-item expanded "><a href="../../../../storage/deprecated/slot-buIlder.html"><strong aria-hidden="true">3.2.4.</strong> CODEX-SLOT-BUILDER</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../../../ift-ts/index.html"><strong aria-hidden="true">4.</strong> IFT-TS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/index.html"><strong aria-hidden="true">4.1.</strong> Raw</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/1/coss.html"><strong aria-hidden="true">4.1.1.</strong> 1/COSS</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/2/mvds.html"><strong aria-hidden="true">4.1.2.</strong> 2/MVDS</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/3/remote-log.html"><strong aria-hidden="true">4.1.3.</strong> 3/REMOTE-LOG</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/4/mvds-meta.html"><strong aria-hidden="true">4.1.4.</strong> 4/MVDS-META</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/25/libp2p-dns-discovery.html"><strong aria-hidden="true">4.1.5.</strong> 25/LIBP2P-DNS-DISCOVERY</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/32/rln-v1.html"><strong aria-hidden="true">4.1.6.</strong> 32/RLN-V1</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/decentralized-messaging-ethereum.html"><strong aria-hidden="true">4.1.7.</strong> ETH-DCGKA</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/eth-mls-offchain.html"><strong aria-hidden="true">4.1.8.</strong> ETH-MLS-OFFCHAIN</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/eth-mls-onchain.html"><strong aria-hidden="true">4.1.9.</strong> ETH-MLS-ONCHAIN</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/deleted/eth-secpm.html"><strong aria-hidden="true">4.1.10.</strong> ETH-SECPM</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/extended-kad-disco.html"><strong aria-hidden="true">4.1.11.</strong> EXTENDED-KADEMLIA-DISCOVERY</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/extensible-peer-records.html"><strong aria-hidden="true">4.1.12.</strong> EXTENSIBLE-PEER-RECORDS</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/gossipsub-tor-push.html"><strong aria-hidden="true">4.1.13.</strong> GOSSIPSUB-TOR-PUSH</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/consensus-hashgraphlike.html"><strong aria-hidden="true">4.1.14.</strong> HASHGRAPHLIKE CONSENSUS</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/logos-capability-discovery.html"><strong aria-hidden="true">4.1.15.</strong> LOGOS-CAPABILITY-DISCOVERY</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/mix.html"><strong aria-hidden="true">4.1.16.</strong> MIX</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/multi-message_id-burn-rln.html"><strong aria-hidden="true">4.1.17.</strong> Multi-message_id Burn RLN</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/noise-x3dh-double-ratchet.html"><strong aria-hidden="true">4.1.18.</strong> NOISE-X3DH-DOUBLE-RATCHET</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/mix-spam-protection-rln.html"><strong aria-hidden="true">4.1.19.</strong> RLN DoS Protection for Mixnet</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/rln-interep-spec.html"><strong aria-hidden="true">4.1.20.</strong> RLN-INTEREP-SPEC</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/rln-stealth-commitments.html"><strong aria-hidden="true">4.1.21.</strong> RLN-STEALTH-COMMITMENTS</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/rln-v2.html"><strong aria-hidden="true">4.1.22.</strong> RLN-V2</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/sds.html"><strong aria-hidden="true">4.1.23.</strong> SDS</a></li><li class="chapter-item expanded "><a href="../../../../ift-ts/raw/zerokit-api.html"><strong aria-hidden="true">4.1.24.</strong> Zerokit API</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../ift-ts/template.html"><strong aria-hidden="true">4.2.</strong> TEMPLATE</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Logos LIP</h1>

                    <div class="right-buttons">
                        <a href="../../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/vacp2p/rfc-index" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="13waku2-store"><a class="header" href="#13waku2-store">13/WAKU2-STORE</a></h1>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody>
<tr><td>Name</td><td>Waku Store Query</td></tr>
<tr><td>Slug</td><td>13</td></tr>
<tr><td>Status</td><td>draft</td></tr>
<tr><td>Editor</td><td>Hanno Cornelius <a href="mailto:hanno@status.im">hanno@status.im</a></td></tr>
<tr><td>Contributors</td><td>Dean Eigenmann <a href="mailto:dean@status.im">dean@status.im</a>, Oskar Thorén <a href="mailto:oskarth@titanproxy.com">oskarth@titanproxy.com</a>, Aaryamann Challani <a href="mailto:p1ge0nh8er@proton.me">p1ge0nh8er@proton.me</a>, Sanaz Taheri <a href="mailto:sanaz@status.im">sanaz@status.im</a></td></tr>
</tbody></table>
</div><!-- timeline:start -->
<h2 id="timeline"><a class="header" href="#timeline">Timeline</a></h2>
<ul>
<li><strong>2026-01-16</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/f01d5b9d9f2ef977b8c089d616991b24f2ee4efe/docs/messaging/standards/core/13/store.md"><code>f01d5b9</code></a> — chore: fix links (#260)</li>
<li><strong>2026-01-16</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/89f2ea89fc1d69ab238b63c7e6fb9e4203fd8529/docs/messaging/standards/core/13/store.md"><code>89f2ea8</code></a> — Chore/mdbook updates (#258)</li>
<li><strong>2025-12-22</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/0f1855edcf68ef982c4ce478b67d660809aa9830/docs/waku/standards/core/13/store.md"><code>0f1855e</code></a> — Chore/fix headers (#239)</li>
<li><strong>2025-12-22</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/b1a578393edf8487ccc97a5f25b25af9bf41efb3/docs/waku/standards/core/13/store.md"><code>b1a5783</code></a> — Chore/mdbook updates (#237)</li>
<li><strong>2025-12-18</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/d03e699084774ebecef9c6d4662498907c5e2080/docs/waku/standards/core/13/store.md"><code>d03e699</code></a> — ci: add mdBook configuration (#233)</li>
<li><strong>2025-04-15</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/1b8b2ac70bb697d52fd0d2201b9e3c59041863cf/waku/standards/core/13/store.md"><code>1b8b2ac</code></a> — Add missing status to 13/WAKU-STORE (#149)</li>
<li><strong>2025-02-03</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/a60a2c45de49966c3550e0f5efe2fa4b081dd40f/waku/standards/core/13/store.md"><code>a60a2c4</code></a> — 13/WAKU-STORE: Update (#124)</li>
<li><strong>2024-09-13</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/3ab314d87d4525ff1296bf3d9ec634d570777b91/waku/standards/core/13/store.md"><code>3ab314d</code></a> — Fix Files for Linting (#94)</li>
<li><strong>2024-08-05</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/eb25cd06d679e94409072a96841de16a6b3910d5/waku/standards/core/13/store.md"><code>eb25cd0</code></a> — chore: replace email addresses (#86)</li>
<li><strong>2024-03-21</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/2eaa7949c4abe7d14e2b9560e8c045bf2e937c9a/waku/standards/core/13/store.md"><code>2eaa794</code></a> — Broken Links + Change Editors (#26)</li>
<li><strong>2024-02-01</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/755be9440d31a71ffdc3c250baa802f0220f29e5/waku/standards/core/13/store.md"><code>755be94</code></a> — Update and rename STORE.md to store.md</li>
<li><strong>2024-01-27</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/3baed074afeae25c69e15af1b6534d0bf89034c2/waku/standards/core/13/STORE.md"><code>3baed07</code></a> — Rename README.md to STORE.md</li>
<li><strong>2024-01-27</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/eef961bfe3b1cf6aab66df5450555afd1d3543cb/waku/standards/core/13/README.md"><code>eef961b</code></a> — remove rfs folder</li>
<li><strong>2024-01-25</strong> — <a href="https://github.com/vacp2p/rfc-index/blob/51e28795c2b64c87c741ec7b3a6669e0d020e1e5/waku/rfcs/standards/core/13/README.md"><code>51e2879</code></a> — Create README.md</li>
</ul>
<!-- timeline:end -->
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>This specification explains the <code>WAKU2-STORE</code> protocol,
which enables querying of <a href="/messaging/standards/core/14/message.html">14/WAKU2-MESSAGE</a>s.</p>
<p><strong>Protocol identifier</strong>*: <code>/vac/waku/store-query/3.0.0</code></p>
<h3 id="terminology"><a class="header" href="#terminology">Terminology</a></h3>
<p>The term PII, Personally Identifiable Information,
refers to any piece of data that can be used to uniquely identify a user.
For example, the signature verification key, and
the hash of one's static IP address are unique for each user and hence count as PII.</p>
<h2 id="wire-specification"><a class="header" href="#wire-specification">Wire Specification</a></h2>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”,
“SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and
“OPTIONAL” in this document are to be interpreted as described in <a href="https://www.ietf.org/rfc/rfc2119.txt">RFC2119</a>.</p>
<h3 id="design-requirements"><a class="header" href="#design-requirements">Design Requirements</a></h3>
<p>The concept of <code>ephemeral</code> messages introduced in <a href="/messaging/standards/core/14/message.html">14/WAKU2-MESSAGE</a> affects <code>WAKU2-STORE</code> as well.
Nodes running <code>WAKU2-STORE</code> SHOULD support <code>ephemeral</code> messages as specified in <a href="/messaging/standards/core/14/message.html">14/WAKU2-MESSAGE</a>.
Nodes running <code>WAKU2-STORE</code> SHOULD NOT store messages with the <code>ephemeral</code> flag set to <code>true</code>.</p>
<h3 id="payloads"><a class="header" href="#payloads">Payloads</a></h3>
<pre><code class="language-protobuf">syntax = "proto3";

// Protocol identifier: /vac/waku/store-query/3.0.0
package waku.store.v3;

import "waku/message/v1/message.proto";

message WakuMessageKeyValue {
  optional bytes message_hash = 1; // Globally unique key for a Waku Message

  // Full message content and associated pubsub_topic as value
  optional waku.message.v1.WakuMessage message = 2;
  optional string pubsub_topic = 3;
}

message StoreQueryRequest {
  string request_id = 1;
  bool include_data = 2; // Response should include full message content
  
  // Filter criteria for content-filtered queries
  optional string pubsub_topic = 10;
  repeated string content_topics = 11;
  optional sint64 time_start = 12;
  optional sint64 time_end = 13;

  // List of key criteria for lookup queries
  repeated bytes message_hashes = 20; // Message hashes (keys) to lookup
  
  // Pagination info. 50 Reserved
  optional bytes pagination_cursor = 51; // Message hash (key) from where to start query (exclusive)
  bool pagination_forward = 52;
  optional uint64 pagination_limit = 53;
}

message StoreQueryResponse {
  string request_id = 1;

  optional uint32 status_code = 10;
  optional string status_desc = 11;

  repeated WakuMessageKeyValue messages = 20;

  optional bytes pagination_cursor = 51;
}
</code></pre>
<h3 id="general-store-query-concepts"><a class="header" href="#general-store-query-concepts">General Store Query Concepts</a></h3>
<h4 id="waku-message-key-value-pairs"><a class="header" href="#waku-message-key-value-pairs">Waku Message Key-Value Pairs</a></h4>
<p>The store query protocol operates as a query protocol for a key-value store of historical messages,
with each entry having a <a href="/messaging/standards/core/14/message.html">14/WAKU2-MESSAGE</a>
and associated <code>pubsub_topic</code> as the value,
and <a href="/messaging/standards/core/14/message.html#deterministic-message-hashing">deterministic message hash</a> as the key.
The store can be queried to return either a set of keys or a set of key-value pairs.</p>
<p>Within the store query protocol,
the <a href="/messaging/standards/core/14/message.html">14/WAKU2-MESSAGE</a> keys and
values MUST be represented in a <code>WakuMessageKeyValue</code> message.
This message MUST contain the deterministic <code>message_hash</code> as the key.
It MAY contain the full <a href="/messaging/standards/core/14/message.html">14/WAKU2-MESSAGE</a> and
associated pubsub topic as the value in the <code>message</code> and
<code>pubsub_topic</code> fields, depending on the use case as set out below.</p>
<p>If the message contains a value entry in addition to the key,
both the <code>message</code> and <code>pubsub_topic</code> fields MUST be populated.
The message MUST NOT have either <code>message</code> or <code>pubsub_topic</code> populated with the other unset.
Both fields MUST either be set or unset.</p>
<h4 id="waku-message-store-eligibility"><a class="header" href="#waku-message-store-eligibility">Waku Message Store Eligibility</a></h4>
<p>In order for a message to be eligible for storage:</p>
<ul>
<li>it MUST be a <em>valid</em> <a href="/messaging/standards/core/14/message.html">14/WAKU2-MESSAGE</a>.</li>
<li>the <code>timestamp</code> field MUST be populated with the Unix epoch time,
at which the message was generated in nanoseconds.
If at the time of storage the <code>timestamp</code> deviates by more than 20 seconds
either into the past or the future when compared to the store node’s internal clock,
the store node MAY reject the message.</li>
<li>the <code>ephemeral</code> field MUST be set to <code>false</code>.</li>
</ul>
<h4 id="waku-message-sorting"><a class="header" href="#waku-message-sorting">Waku message sorting</a></h4>
<p>The key-value entries in the store MUST be time-sorted by the <a href="/messaging/standards/core/14/message.html">14/WAKU2-MESSAGE</a> <code>timestamp</code> attribute.
Where two or more key-value entries have identical <code>timestamp</code> values,
the entries MUST be further sorted by the natural order of their message hash keys.
Within the context of traversing over key-value entries in the store,
<em>"forward"</em> indicates traversing the entries in ascending order,
whereas <em>"backward"</em> indicates traversing the entries in descending order.</p>
<h4 id="pagination"><a class="header" href="#pagination">Pagination</a></h4>
<p>If a large number of entries in the store service node match the query criteria provided in a <code>StoreQueryRequest</code>,
the client MAY make use of pagination
in a chain of store query request and response transactions
to retrieve the full response in smaller batches termed <em>"pages"</em>.
Pagination can be performed either in <a href="#waku-message-sorting">a <em>forward</em> or <em>backward</em> direction</a>.</p>
<p>A store query client MAY indicate the maximum number of matching entries it wants in the <code>StoreQueryResponse</code>,
by setting the page size limit in the <code>pagination_limit</code> field.
Note that a store service node MAY enforce its own limit
if the <code>pagination_limit</code> is unset
or larger than the service node's internal page size limit.</p>
<p>A <code>StoreQueryResponse</code> with a populated <code>pagination_cursor</code> indicates that more stored entries match the query than included in the response.</p>
<p>A <code>StoreQueryResponse</code> without a populated <code>pagination_cursor</code> indicates that
there are no more matching entries in the store.</p>
<p>The client MAY request the next page of entries from the store service node
by populating a subsequent <code>StoreQueryRequest</code> with the <code>pagination_cursor</code>
received in the <code>StoreQueryResponse</code>.
All other fields and query criteria MUST be the same as in the preceding <code>StoreQueryRequest</code>.</p>
<p>A <code>StoreQueryRequest</code> without a populated <code>pagination_cursor</code> indicates that
the client wants to retrieve the "first page" of the stored entries matching the query.</p>
<h3 id="store-query-request"><a class="header" href="#store-query-request">Store Query Request</a></h3>
<p>A client node MUST send all historical message queries within a <code>StoreQueryRequest</code> message.
This request MUST contain a <code>request_id</code>.
The <code>request_id</code> MUST be a uniquely generated string.</p>
<p>If the store query client requires the store service node to include <a href="/messaging/standards/core/14/message.html">14/WAKU2-MESSAGE</a> values in the query response,
it MUST set <code>include_data</code> to <code>true</code>.
If the store query client requires the store service node to return only message hash keys in the query response,
it SHOULD set <code>include_data</code> to <code>false</code>.
By default, therefore, the store service node assumes <code>include_data</code> to be <code>false</code>.</p>
<p>A store query client MAY include query filter criteria in the <code>StoreQueryRequest</code>.
There are two types of filter use cases:</p>
<ol>
<li>Content filtered queries and</li>
<li>Message hash lookup queries</li>
</ol>
<h4 id="content-filtered-queries"><a class="header" href="#content-filtered-queries">Content filtered queries</a></h4>
<p>A store query client MAY request the store service node to filter historical entries by a content filter.
Such a client MAY create a filter on content topic, on time range or on both.</p>
<p>To filter on content topic,
the client MUST populate <em>both</em> the <code>pubsub_topic</code> <em>and</em> <code>content_topics</code> field.
The client MUST NOT populate either <code>pubsub_topic</code> or
<code>content_topics</code> and leave the other unset.
Both fields MUST either be set or unset.
A mixed content topic filter with just one of either <code>pubsub_topic</code> or
<code>content_topics</code> set, SHOULD be regarded as an invalid request.</p>
<p>To filter on time range, the client MUST set <code>time_start</code>, <code>time_end</code> or both.
Each <code>time_</code> field should contain a Unix epoch timestamp in nanoseconds.
An unset <code>time_start</code> SHOULD be interpreted as "from the oldest stored entry".
An unset <code>time_end</code> SHOULD be interpreted as "up to the youngest stored entry".</p>
<p>If any of the content filter fields are set,
namely <code>pubsub_topic</code>, <code>content_topic</code>, <code>time_start</code>, or <code>time_end</code>,
the client MUST NOT set the <code>message_hashes</code> field.</p>
<h4 id="message-hash-lookup-queries"><a class="header" href="#message-hash-lookup-queries">Message hash lookup queries</a></h4>
<p>A store query client MAY request the store service node to filter historical entries by one or
more matching message hash keys.
This type of query acts as a "lookup" against a message hash key or
set of keys already known to the client.</p>
<p>In order to perform a lookup query,
the store query client MUST populate the <code>message_hashes</code> field with the list of message hash keys it wants to lookup in the store service node.</p>
<p>If the <code>message_hashes</code> field is set,
the client MUST NOT set any of the content filter fields,
namely <code>pubsub_topic</code>, <code>content_topic</code>, <code>time_start</code>, or <code>time_end</code>.</p>
<h4 id="presence-queries"><a class="header" href="#presence-queries">Presence queries</a></h4>
<p>A presence query is a special type of lookup query that allows a client to check for the presence of one or
more messages in the store service node,
without retrieving the full contents (values) of the messages.
This can, for example, be used as part of a reliability mechanism,
whereby store query clients verify that previously published messages have been successfully stored.</p>
<p>In order to perform a presence query,
the store query client MUST populate the <code>message_hashes</code> field in the <code>StoreQueryRequest</code> with the list of message hashes
for which it wants to verify presence in the store service node.
The <code>include_data</code> property MUST be set to <code>false</code>.
The client SHOULD interpret every <code>message_hash</code> returned in the <code>messages</code> field of the <code>StoreQueryResponse</code> as present in the store.
The client SHOULD assume that all other message hashes included in the original <code>StoreQueryRequest</code> but
not in the <code>StoreQueryResponse</code> is not present in the store.</p>
<h4 id="pagination-info"><a class="header" href="#pagination-info">Pagination info</a></h4>
<p>The store query client MAY include a message hash as <code>pagination_cursor</code>,
to indicate at which key-value entry a store service node SHOULD start the query.
The <code>pagination_cursor</code> is treated as exclusive
and the corresponding entry will not be included in subsequent store query responses.</p>
<p>For forward queries,
only messages following (see <a href="#waku-message-sorting">sorting</a>) the one indexed at <code>pagination_cursor</code>
will be returned.
For backward queries,
only messages preceding (see <a href="#waku-message-sorting">sorting</a>) the one indexed at <code>pagination_cursor</code>
will be returned.</p>
<p>If the store query client requires the store service node to perform a forward query,
it MUST set <code>pagination_forward</code> to <code>true</code>.
If the store query client requires the store service node to perform a backward query,
it SHOULD set <code>pagination_forward</code> to <code>false</code>.
By default, therefore, the store service node assumes pagination to be backward.</p>
<p>A store query client MAY indicate the maximum number of matching entries it wants in the <code>StoreQueryResponse</code>,
by setting the page size limit in the <code>pagination_limit</code> field.
Note that a store service node MAY enforce its own limit
if the <code>pagination_limit</code> is unset
or larger than the service node's internal page size limit.</p>
<p>See <a href="#pagination">pagination</a> for more on how the pagination info is used in store transactions.</p>
<h3 id="store-query-response"><a class="header" href="#store-query-response">Store Query Response</a></h3>
<p>In response to any <code>StoreQueryRequest</code>,
a store service node SHOULD respond with a <code>StoreQueryResponse</code> with a <code>requestId</code> matching that of the request.
This response MUST contain a <code>status_code</code> indicating if the request was successful or not.
Successful status codes are in the <code>2xx</code> range.
A client node SHOULD consider all other status codes as error codes and
assume that the requested operation had failed.
In addition,
the store service node MAY choose to provide a more detailed status description in the <code>status_desc</code> field.</p>
<h4 id="filter-matching"><a class="header" href="#filter-matching">Filter matching</a></h4>
<p>For <a href="#content-filtered-queries">content filtered queries</a>,
an entry in the store service node matches the filter criteria in a <code>StoreQueryRequest</code> if each of the following conditions are met:</p>
<ul>
<li>its <code>content_topic</code> is in the request <code>content_topics</code> set
and it was published on a matching <code>pubsub_topic</code> OR the request <code>content_topics</code> and
<code>pubsub_topic</code> fields are unset</li>
<li>its <code>timestamp</code> is <em>larger or equal</em> than the request <code>start_time</code> OR the request <code>start_time</code> is unset</li>
<li>its <code>timestamp</code> is <em>smaller</em> than the request <code>end_time</code> OR the request <code>end_time</code> is unset</li>
</ul>
<p>Note that for content filtered queries, <code>start_time</code> is treated as <em>inclusive</em> and
<code>end_time</code> is treated as <em>exclusive</em>.</p>
<p>For <a href="#message-hash-lookup-queries">message hash lookup queries</a>,
an entry in the store service node matches the filter criteria if its <code>message_hash</code> is in the request <code>message_hashes</code> set.</p>
<p>The store service node SHOULD respond with an error code and
discard the request if the store query request contains both content filter criteria
and message hashes.</p>
<h4 id="populating-response-messages"><a class="header" href="#populating-response-messages">Populating response messages</a></h4>
<p>The store service node SHOULD populate the <code>messages</code> field in the response
only with entries matching the filter criteria provided in the corresponding request.
Regardless of whether the response is to a <em>forward</em> or <em>backward</em> query,
the <code>messages</code> field in the response MUST be ordered in a forward direction
according to the <a href="#waku-message-sorting">message sorting rules</a>.</p>
<p>If the corresponding <code>StoreQueryRequest</code> has <code>include_data</code> set to true,
the service node SHOULD populate both the <code>message_hash</code> and
<code>message</code> for each entry in the response.
In all other cases,
the store service node SHOULD populate only the <code>message_hash</code> field for each entry in the response.</p>
<h4 id="paginating-the-response"><a class="header" href="#paginating-the-response">Paginating the response</a></h4>
<p>The response SHOULD NOT contain more <code>messages</code> than the <code>pagination_limit</code> provided in the corresponding <code>StoreQueryRequest</code>.
It is RECOMMENDED that the store node defines its own maximum page size internally.
If the <code>pagination_limit</code> in the request is unset,
or exceeds this internal maximum page size,
the store service node SHOULD ignore the <code>pagination_limit</code> field and
apply its own internal maximum page size.</p>
<p>In response to a <em>forward</em> <code>StoreQueryRequest</code>:</p>
<ul>
<li>if the <code>pagination_cursor</code> is set,
the store service node SHOULD populate the <code>messages</code> field
with matching entries following the <code>pagination_cursor</code> (exclusive).</li>
<li>if the <code>pagination_cursor</code> is unset,
the store service node SHOULD populate the <code>messages</code> field
with matching entries from the first entry in the store.</li>
<li>if there are still more matching entries in the store
after the maximum page size is reached while populating the response,
the store service node SHOULD populate the <code>pagination_cursor</code> in the <code>StoreQueryResponse</code>
with the message hash key of the <em>last</em> entry <em>included</em> in the response.</li>
</ul>
<p>In response to a <em>backward</em> <code>StoreQueryRequest</code>:</p>
<ul>
<li>if the <code>pagination_cursor</code> is set,
the store service node SHOULD populate the <code>messages</code> field
with matching entries preceding the <code>pagination_cursor</code> (exclusive).</li>
<li>if the <code>pagination_cursor</code> is unset,
the store service node SHOULD populate the <code>messages</code> field
with matching entries from the last entry in the store.</li>
<li>if there are still more matching entries in the store
after the maximum page size is reached while populating the response,
the store service node SHOULD populate the <code>pagination_cursor</code> in the <code>StoreQueryResponse</code>
with the message hash key of the <em>first</em> entry <em>included</em> in the response.</li>
</ul>
<h3 id="security-consideration"><a class="header" href="#security-consideration">Security Consideration</a></h3>
<p>The main security consideration while using this protocol is that a querying node has to reveal its content filters of interest to the queried node,
hence potentially compromising their privacy.</p>
<h4 id="adversarial-model"><a class="header" href="#adversarial-model">Adversarial Model</a></h4>
<p>Any peer running the <code>WAKU2-STORE</code> protocol, i.e.
both the querying node and the queried node, are considered as an adversary.
Furthermore,
we currently consider the adversary as a passive entity that attempts to collect information from other peers to conduct an attack but
it does so without violating protocol definitions and instructions.
As we evolve the protocol,
further adversarial models will be considered.
For example, under the passive adversarial model,
no malicious node hides or
lies about the history of messages as it is against the description of the <code>WAKU2-STORE</code> protocol.</p>
<p>The following are not considered as part of the adversarial model:</p>
<ul>
<li>An adversary with a global view of all the peers and their connections.</li>
<li>An adversary that can eavesdrop on communication links between arbitrary pairs of peers (unless the adversary is one end of the communication).
Specifically, the communication channels are assumed to be secure.</li>
</ul>
<h3 id="future-work"><a class="header" href="#future-work">Future Work</a></h3>
<ul>
<li>
<p><strong>Anonymous query</strong>: This feature guarantees that nodes can anonymously query historical messages from other nodes i.e.,
without disclosing the exact topics of <a href="/messaging/standards/core/14/message.html">14/WAKU2-MESSAGE</a> they are interested in.<br />
As such, no adversary in the <code>WAKU2-STORE</code> protocol would be able to learn which peer is interested in which content filters i.e.,
content topics of <a href="/messaging/standards/core/14/message.html">14/WAKU2-MESSAGE</a>.
The current version of the <code>WAKU2-STORE</code> protocol does not provide anonymity for historical queries,
as the querying node needs to directly connect to another node in the <code>WAKU2-STORE</code> protocol and
explicitly disclose the content filters of its interest to retrieve the corresponding messages.
However, one can consider preserving anonymity through one of the following ways:</p>
</li>
<li>
<p>By hiding the source of the request i.e., anonymous communication.
That is the querying node shall hide all its PII in its history request e.g.,
its IP address.
This can happen by the utilization of a proxy server or by using Tor.
Note that the current structure of historical requests does not embody any piece of PII, otherwise,
such data fields must be treated carefully to achieve query anonymity.</p>
</li>
</ul>
<!-- TODO: if nodes have to disclose their PeerIDs
(e.g., for authentication purposes) when connecting to other nodes in the store protocol,
then Tor does not preserve anonymity since it only helps in hiding the IP.
So, the PeerId usage in switches must be investigated further.
Depending on how PeerId is used, one may be able to link between a querying node 
and its queried topics despite hiding the IP address-->
<ul>
<li>By deploying secure 2-party computations
in which the querying node obtains the historical messages of a certain topic,
the queried node learns nothing about the query.
Examples of such 2PC protocols are secure one-way Private Set Intersections (PSI).</li>
</ul>
<!-- TODO: add a reference for PSIs? --> <!-- TODO: more techniques to be included -->
<!-- TODO: Censorship resistant:
this is about a node that hides the historical messages from other nodes.
This attack is not included in the specs since it does not fit the
passive adversarial model (the attacker needs to deviate from the store protocol).-->
<ul>
<li><strong>Robust and verifiable timestamps</strong>: Messages timestamp is a way to show that
the message existed prior to some point in time.
However, the lack of timestamp verifiability can create room for a range of attacks,
including injecting messages with invalid timestamps pointing to the far future.
To better understand the attack,
consider a store node whose current clock shows <code>2021-01-01 00:00:30</code>
(and assume all the other nodes have a synchronized clocks +-20seconds).
The store node already has a list of messages,
<code>(m1,2021-01-01 00:00:00), (m2,2021-01-01 00:00:01), ..., (m10:2021-01-01 00:00:20)</code>,
that are sorted based on their timestamp.<br />
An attacker sends a message with an arbitrary large timestamp e.g.,
10 hours ahead of the correct clock <code>(m',2021-01-01 10:00:30)</code>.
The store node places <code>m'</code> at the end of the list,
<code>(m1,2021-01-01 00:00:00), (m2,2021-01-01 00:00:01), ..., (m10:2021-01-01 00:00:20), (m',2021-01-01 10:00:30)</code>.
Now another message arrives with a valid timestamp e.g.,
<code>(m11, 2021-01-01 00:00:45)</code>.
However, since its timestamp precedes the malicious message <code>m'</code>,
it gets placed before <code>m'</code> in the list i.e.,
<code>(m1,2021-01-01 00:00:00), (m2,2021-01-01 00:00:01), ..., (m10:2021-01-01 00:00:20), (m11, 2021-01-01 00:00:45), (m',2021-01-01 10:00:30)</code>.
In fact, for the next 10 hours,
<code>m'</code> will always be considered as the most recent message and
served as the last message to the querying nodes irrespective of how many other
messages arrive afterward.</li>
</ul>
<p>A robust and verifiable timestamp allows the receiver of a message to verify that
a message has been generated prior to the claimed timestamp.
One solution is the use of <a href="https://opentimestamps.org/">open timestamps</a> e.g.,
block height in Blockchain-based timestamps.
That is, messages contain the most recent block height perceived by their senders
at the time of message generation.
This proves accuracy within a range of minutes (e.g., in Bitcoin blockchain) or
seconds (e.g., in Ethereum 2.0) from the time of origination.</p>
<h2 id="copyright"><a class="header" href="#copyright">Copyright</a></h2>
<p>Copyright and related rights waived via
<a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
<h2 id="previous-versions"><a class="header" href="#previous-versions">Previous versions</a></h2>
<ul>
<li><a href="previous-versions/00/store.html">00</a></li>
</ul>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ol>
<li><a href="/messaging/standards/core/14/message.html">14/WAKU2-MESSAGE</a></li>
<li><a href="https://developers.google.com/protocol-buffers/">protocol buffers v3</a></li>
<li><a href="https://opentimestamps.org/">Open timestamps</a></li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../../messaging/standards/core/12/previous-versions/00/filter.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../../messaging/standards/core/13/previous-versions/00/store.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../../messaging/standards/core/12/previous-versions/00/filter.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../../messaging/standards/core/13/previous-versions/00/store.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../../elasticlunr.min.js"></script>
        <script src="../../../../mark.min.js"></script>
        <script src="../../../../searcher.js"></script>

        <script src="../../../../clipboard.min.js"></script>
        <script src="../../../../highlight.js"></script>
        <script src="../../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../../scripts/rfc-index.js"></script>


    </div>
    </body>
</html>
